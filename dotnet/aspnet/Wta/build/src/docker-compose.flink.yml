include: [ "docker-compose.include.yml" ]

services:
  flink-jobmanager:
    image: ${FLINK}
    extends:
      file: docker-compose.extend.yml
      service: base
    networks:
      net:
        ipv4_address: ${FLINK_IP}
    environment:
      - JOB_MANAGER_RPC_ADDRESS=flink-jobmanager
    ports:
      - 8081:8081
    volumes:
      - ./apps/flink/conf/flink-conf.yaml:/opt/flink/conf/flink-conf.yaml
      - ./apps/flink/cdc:/opt/flink/cdc
      - ./apps/flink/lib/mysql-connector-java-8.0.30.jar:/opt/flink/lib/mysql-connector-java-8.0.30.jar
      - ./apps/flink/lib/flink-cdc-dist-3.2.0.jar:/opt/flink/lib/flink-cdc-dist-3.2.0.jar
      - ./apps/flink/lib/flink-doris-connector-1.20-24.0.0.jar:/opt/flink/lib/flink-doris-connector-1.20-24.0.0.jar
      - ${LOGS}/flink-jobmanager:/opt/flink/log
    command: jobmanager
  flink-taskmanager:
    image:  ${FLINK}
    extends:
      file: docker-compose.extend.yml
      service: base
    networks:
      net:
        ipv4_address: ${FLINK_TASKMANAGER_IP}
    environment:
      - JOB_MANAGER_RPC_ADDRESS=flink-jobmanager
    volumes:
      - ./apps/flink/conf/flink-conf.yaml:/opt/flink/conf/flink-conf.yaml
      - ./apps/flink/cdc:/opt/flink/cdc
      - ./apps/flink/lib/mysql-connector-java-8.0.30.jar:/opt/flink/lib/mysql-connector-java-8.0.30.jar
      - ./apps/flink/lib/flink-cdc-dist-3.2.0.jar:/opt/flink/lib/flink-cdc-dist-3.2.0.jar
      - ./apps/flink/lib/flink-doris-connector-1.20-24.0.0.jar:/opt/flink/lib/flink-doris-connector-1.20-24.0.0.jar
      - ${LOGS}/flink-taskmanager:/opt/flink/log
    command: taskmanager
    depends_on:
      - flink-jobmanager
