class e{constructor(e){const{Request:t,baseURL:n,timeout:a=5e5,messageError:o}=e;this._messageError=o,this.req=new t({baseURL:n,timeout:a,messageError:o})}get_session_id(){return this.req.constructor._sid}get_cids_local(e){const t=this.req.localStorage.getItem("cid")||"";if(t){const n=t.split(",").map((e=>Number(e))),a=n.filter((t=>e.includes(t)));if(a.length){if(n.length>a.length){const e=a.join(",");this.req.localStorage.setItem("cid",e)}return a}return this.req.localStorage.removeItem("cid"),e}return e}set_cids_local(e){const t=e.join(",");this.req.localStorage.setItem("cid",t)}async jsoncall(e,t={},n={}){const a="/"===e[0]?e:`/${e}`,o={jsonrpc:"2.0",method:"call",params:t,id:Math.floor(1e9*Math.random()+1)},i=(await this.req.call_post(a,o)).data,{result:s,error:r}=i,{throw_error:c}=n;return r?(console.log("odoo response error"),this._messageError&&!c?this._messageError(r):Promise.reject(r)):s}}class t{constructor(e){const{jsonrpc:t}=e;this._jsonrpc=t}async json_call(e,t={},n){return this._jsonrpc.jsoncall(e,t,n)}}class n extends t{constructor(...e){super(...e)}async version_info(){return this.json_call("/web/webclient/version_info",{})}}class a extends t{constructor(...e){super(...e)}async list(){return this.json_call("/web/database/list",{})}}class o extends t{constructor(...e){super(...e),this._session_info={}}get session_info(){return this._session_info}set session_info(e){this._session_info=e}get user_context(){const{user_context:e={}}=this.session_info;return e}get lang(){const{lang:e="en_US"}=this.user_context;return e}get current_company_id(){const{user_companies:e={}}=this.session_info,{current_company:t}=e;return t}get company(){return{id:this.current_company_id}}get cids_odoo(){const e=this.session_info||{},{user_companies:t={}}=e,{allowed_companies:n={}}=t;return Object.values(n).map((e=>e.id))}get_cids_local(e){return this._jsonrpc.get_cids_local(e)}get cids_local(){const e=this.cids_odoo;return this.get_cids_local(e)}set_cids_local(e){return this._jsonrpc.set_cids_local(e)}set cids_local(e){return this.set_cids_local(e)}get_session_id(){return this._jsonrpc.get_session_id()}async authenticate(e){const t=await this.json_call("/web/session/authenticate",e);return this._session_info=t,t}async get_session_info(){const e=await this.json_call("/web/session/get_session_info",{});return this._session_info=e,e}async check(){return await this.json_call("/web/session/check",{},{throw_error:1})}async destroy(){return await this.json_call("/web/session/destroy",{}),this._session_info=void 0,!0}async logout(){try{return await this.destroy(),!0}catch(e){return!1}}async session_check(){const e=await(async()=>{try{return await this.check(),!0}catch(e){return!1}})();return e?await this.get_session_info():e}async modules(){return this.json_call("/web/session/modules",{})}}class i extends t{constructor(...e){super(...e)}async call_kw(e,t,n,a){const o=`/web/dataset/call_kw/${e}/${t}`;return this.json_call(o,{model:e,method:t,args:n,kwargs:a})}async _raw_call_button(e,t,n,a){return this.json_call("/web/dataset/call_button",{model:e,method:t,args:n,kwargs:a})}async call_button(e,t,n,a){try{return{result:await this._raw_call_button(e,t,n,a)}}catch(e){return!1}}}const s=class extends t{constructor(...e){super(...e),this.webclient=new n(...e),this.database=new a(...e),this.session=new o(...e),this.dataset=new i(...e)}};class r{constructor(e){this.web=new s(e)}}const c={str:"[('country_id', '=?', country_id)]",domain:[["country_id","=?",{field_country_id:{}}]]},d={str:"[('country_id', '=?', country)]",domain:[["country_id","=?",{field_country:{}}]]},_={str:"[('country_id', '=?', private_country_id)]",domain:[["country_id","=?",{field_private_country_id:{}}]]},l={str:"[('partner_id', '=', work_contact_id), '|', ('company_id', '=', False), ('company_id', '=', company_id)]",domain:[["partner_id","=",{field_work_contact_id:{}}],"|",["company_id","=",!1],["company_id","=",{field_company_id:{}}]]},m={str:"(company_id and ['|', ('company_id', '=', False), ('company_id', 'in', [company_id])] or [('company_id', '=', False)]) + ([])",domain:["|",["company_id","=",!1],["company_id","in",[{field_company_id:{}}]]]},u={str:"(company_id and ['|', ('company_id', '=', False), ('company_id', 'in', [company_id])] or [('company_id', '=', False)]) + ([('company_id', '=', company_id)])",domain:[...m.domain]},p={str:"(company_id and ['|', ('company_id', '=', False), ('company_id', 'in', [company_id])] or []) + ([])",domain:["|",["company_id","=",!1],["company_id","in",[{field_company_id:{}}]]]},h={str:"(company_id and ['|', ('company_id', '=', False), ('company_id', 'in', [company_id])] or [('company_id', '=', False)]) + (['|', ('company_id', '=', False), ('company_id', '=', company_id)])",domain:[...m.domain,"|",["company_id","=",!1],["company_id","=",{field_company_id:{}}]]},y={str:"(company_id and ['|', ('company_id', '=', False), ('company_id', 'in', [company_id])] or []) + (['|', ('company_id', '=', False), ('company_id', '=', company_id)])",domain:[...m.domain,"|",["company_id","=",!1],["company_id","=",{field_company_id:{}}]]},f={str:"(company_id and ['|', ('company_id', '=', False), ('company_id', 'parent_of', [company_id])] or ['|', ('company_id', '=', False), ('company_id', 'parent_of', [''])]) + ([])",domain:["|",["company_id","=",!1],["company_id","parent_of",[{field_company_id:{}}]]]},g={str:"(company_id and ['|', ('company_id', '=', False), ('company_id', 'parent_of', [company_id])] or []) + ([])",domain:["|",["company_id","=",!1],["company_id","parent_of",[{field_company_id:{}}]]]},b={str:"(company_id and ['|', ('company_id', '=', False), ('company_id', 'parent_of', [company_id])] or []) + ([('company_id', '=', company_id)])",domain:["|",["company_id","=",!1],["company_id","parent_of",[{field_company_id:{}}]]]},w={str:"(company_id and ['|', ('company_id', '=', False), ('company_id', 'parent_of', [company_id])] or ['|', ('company_id', '=', False), ('company_id', 'parent_of', [''])]) + ([('company_id', '=', company_id)])",domain:[...f.domain,["company_id","=",{field_company_id:{}}]]},v={str:"(company_id and ['|', ('company_id', '=', False), ('company_id', 'in', [company_id])] or [('company_id', '=', False)]) + (['|', ('parent_id','=', False), ('is_company','=', True)])",domain:[...m.domain,"|",["parent_id","=",!1],["is_company","=",!0]]},j={str:"(company_id and ['|', ('company_id', '=', False), ('company_id', 'in', [company_id])] or []) + (['|', ('parent_id','=', False), ('is_company','=', True)])",domain:[...m.domain,"|",["parent_id","=",!1],["is_company","=",!0]]},k={str:"[('company_id', 'in', (False, company_id))]",domain:[["company_id","in",[!1,{field_company_id:{}}]]]},x={str:"['|', ('company_id', '=', False), ('company_id', '=', company_id)]",domain:[["|",["company_id","=",!1],["company_id","=",{field_company_id:{}}]]]},F={str:"(company_id and [('company_ids', 'in', [company_id])] or []) + ([])",domain:["|",["company_id","=",!1],["company_ids","in",[{field_company_id:{}}]]]},O={str:"['&', ('share', '=', False), ('company_ids', 'in', member_company_ids)]",domain:["&",["share","=",!1],["company_ids","in",{field_member_company_ids:{}}]]},M={str:"(company_id and ['|', ('company_id', '=', False), ('company_id', 'in', [company_id])] or []) + ([('product_tmpl_id', '=', product_tmpl_id)] if product_tmpl_id else [])",domain:["&",...m.domain,"|",["product_tmpl_id","=",!1],["product_tmpl_id","=",{field_product_tmpl_id:{}}]]},A={str:"(company_id and ['|', ('company_id', '=', False), ('company_id', 'in', [company_id])] or [('company_id', '=', False)]) + ([('product_tmpl_id', '=', product_tmpl_id)] if product_tmpl_id else [])",domain:["&",...m.domain,"|",["product_tmpl_id","=",!1],["product_tmpl_id","=",{field_product_tmpl_id:{}}]]},S={str:"[('sale_ok', '=', True)]",domain:[["sale_ok","=",!0]]},$={str:"(company_id and ['|', ('company_id', '=', False), ('company_id', 'in', [company_id])] or []) + ([('sale_ok', '=', True)])",domain:["&",...m.domain,["sale_ok","=",!0]]},E={str:"(company_id and ['|', ('company_id', '=', False), ('company_id', 'in', [company_id])] or [('company_id', '=', False)]) + ([('type', 'in', ['product', 'consu'])])",domain:[...m.domain,["type","in",["product","consu"]]]},N={str:"(company_id and ['|', ('company_id', '=', False), ('company_id', 'in', [company_id])] or []) + ([('type', 'in', ['product', 'consu'])])",domain:[...m.domain,["type","in",["product","consu"]]]},q={str:"(company_id and ['|', ('company_id', '=', False), ('company_id', 'in', [company_id])] or [('company_id', '=', False)]) + (['&', ('product_tmpl_id', '=', product_tmpl_id), ('type', 'in', ['product', 'consu'])])",domain:["&",...m.domain,"&",["product_tmpl_id","=",{field_product_tmpl_id:{}}],["type","in",["product","consu"]]]},J={str:"(company_id and ['|', ('company_id', '=', False), ('company_id', 'in', [company_id])] or [('company_id', '=', False)]) + ([('type', '!=', 'service')])",domain:[...m.domain,["type","!=","service"]]},D={str:"(company_id and ['|', ('company_id', '=', False), ('company_id', 'in', [company_id])] or []) + ([('type', '!=', 'service')])",domain:[...m.domain,["type","!=","service"]]},L={str:"[('type', 'in', ['product', 'consu'])]",domain:[["type","in",["product","consu"]]]},C={str:"[('category_id', '=', product_uom_category_id)]",domain:[["category_id","=",{field_product_uom_category_id:{}}]]},U={str:"[('attribute_id', '=', attribute_id)]",domain:[["attribute_id","=",{field_attribute_id:{}}]]},R={str:"(company_id and ['|', ('company_id', '=', False), ('company_id', 'in', [company_id])] or [('company_id', '=', False)]) + ([('sales', '=', True), ('product_id','=',product_id)])",domain:[...m.domain,["sales","=",!0],["product_id","=",{field_product_id:{}}]]},T={str:"(company_id and ['|', ('company_id', '=', False), ('company_id', 'in', [company_id])] or []) + ([('sales', '=', True), ('product_id','=',product_id)])",domain:[...m.domain,["sales","=",!0],["product_id","=",{field_product_id:{}}]]},I={str:"(company_id and ['|', ('company_id', '=', False), ('company_id', 'in', [company_id])] or [('company_id', '=', False)]) + ([('purchase', '=', True), ('product_id', '=', product_id)])",domain:[...m.domain,["purchase","=",!0],["product_id","=",{field_product_id:{}}]]},z={str:"(company_id and ['|', ('company_id', '=', False), ('company_id', 'in', [company_id])] or []) + ([('purchase', '=', True), ('product_id', '=', product_id)])",domain:["&",...m.domain,["purchase","=",!0],["product_id","=",{field_product_id:{}}]]},P={str:"(company_id and ['|', ('company_id', '=', False), ('company_id', 'in', [company_id])] or [('company_id', '=', False)]) + ([('product_id', '=', product_id)])",domain:[...m.domain,["product_id","=",{field_product_id:{}}]]},Q={str:"(company_id and ['|', ('company_id', '=', False), ('company_id', 'in', [company_id])] or []) + ([('product_id', '=', product_id)])",domain:[...m.domain,["product_id","=",{field_product_id:{}}]]},B={str:"(company_id and ['|', ('company_id', '=', False), ('company_id', 'in', [company_id])] or [('company_id', '=', False)]) + ([('payment_type', '=', 'inbound')])",domain:[...m.domain,["payment_type","=","inbound"]]},G={str:"(company_id and ['|', ('company_id', '=', False), ('company_id', 'in', [company_id])] or []) + ([('payment_type', '=', 'inbound')])",domain:[...m.domain,["payment_type","=","inbound"]]},H={str:"(company_id and ['|', ('company_id', '=', False), ('company_id', 'in', [company_id])] or [('company_id', '=', False)]) + ([('payment_type', '=', 'outbound')])",domain:[...m.domain,["payment_type","=","outbound"]]},K={str:"(company_id and ['|', ('company_id', '=', False), ('company_id', 'in', [company_id])] or []) + ([('payment_type', '=', 'outbound')])",domain:[...m.domain,["payment_type","=","outbound"]]},V={str:"[('payment_type', '=?', payment_type), ('id', 'in', available_payment_method_ids)]",domain:[["payment_type","=?",{field_payment_type:{}}],["id","in",{field_available_payment_method_ids:{}}]]},W={str:"[('id', 'in', available_payment_method_line_ids)]",domain:[["id","in",{field_available_payment_method_line_ids:{}}]]},X={str:"['&', ('deprecated', '=', False), ('account_type', 'not in', ('asset_receivable','liability_payable','asset_cash','liability_credit_card','off_balance'))]",domain:["&",["deprecated","=",!1],["account_type","not in",["asset_receivable","liability_payable","asset_cash","liability_credit_card","off_balance"]]]},Y={str:"(company_id and ['|', ('company_id', '=', False), ('company_id', 'parent_of', [company_id])] or ['|', ('company_id', '=', False), ('company_id', 'parent_of', [''])]) + ([('deprecated', '=', False), ('account_type', '!=', 'off_balance')])",domain:[...f.domain,["deprecated","=",!1],["account_type","=","off_balance"]]},Z={str:"(company_id and ['|', ('company_id', '=', False), ('company_id', 'parent_of', [company_id])] or []) + ([('deprecated', '=', False), ('account_type', '!=', 'off_balance')])",domain:[...f.domain,["deprecated","=",!1],["account_type","=","off_balance"]]},ee={str:"(company_id and ['|', ('company_id', '=', False), ('company_id', 'parent_of', [company_id])] or ['|', ('company_id', '=', False), ('company_id', 'parent_of', [''])]) + ([('deprecated', '=', False)])",domain:[...f.domain,["deprecated","=",!1]]},te={str:"(company_id and ['|', ('company_id', '=', False), ('company_id', 'parent_of', [company_id])] or []) + ([('deprecated', '=', False)])",domain:[...f.domain,["deprecated","=",!1]]},ne={str:"(company_id and ['|', ('company_id', '=', False), ('company_id', 'parent_of', [company_id])] or ['|', ('company_id', '=', False), ('company_id', 'parent_of', [''])]) + ([('deprecated', '=', False),'|', ('account_type', '=', default_account_type), ('account_type', 'not in', ('asset_receivable', 'liability_payable'))])",domain:[...f.domain,["deprecated","=",!1],"|",["account_type","=",{field_default_account_type:{}}],["account_type","not in",["asset_receivable","liability_payable"]]]},ae={str:"(company_id and ['|', ('company_id', '=', False), ('company_id', 'parent_of', [company_id])] or []) + ([('deprecated', '=', False),'|', ('account_type', '=', default_account_type), ('account_type', 'not in', ('asset_receivable', 'liability_payable'))])",domain:[...f.domain,["deprecated","=",!1],"|",["account_type","=",{field_default_account_type:{}}],["account_type","not in",["asset_receivable","liability_payable"]]]},oe={str:"(company_id and ['|', ('company_id', '=', False), ('company_id', 'parent_of', [company_id])] or ['|', ('company_id', '=', False), ('company_id', 'parent_of', [''])]) + ([('deprecated', '=', False), ('account_type', '=', 'asset_current')])",domain:[...f.domain,["deprecated","=",!1],["account_type","=","asset_current"]]},ie={str:"(company_id and ['|', ('company_id', '=', False), ('company_id', 'parent_of', [company_id])] or []) + ([('deprecated', '=', False), ('account_type', '=', 'asset_current')])",domain:[...f.domain,["deprecated","=",!1],["account_type","=","asset_current"]]},se={str:"(company_id and ['|', ('company_id', '=', False), ('company_id', 'parent_of', [company_id])] or ['|', ('company_id', '=', False), ('company_id', 'parent_of', [''])]) + ([('deprecated', '=', False), '|', ('account_type', 'in', ('asset_current', 'liability_current')), ('id', '=', parent.default_account_id)])",domain:[...f.domain,["deprecated","=",!1],"|",["account_type","in",["asset_current","liability_current"]],["id","=",{field_parent_default_account_id:{}}]]},re={str:"(company_id and ['|', ('company_id', '=', False), ('company_id', 'parent_of', [company_id])] or []) + ([('deprecated', '=', False), '|', ('account_type', 'in', ('asset_current', 'liability_current')), ('id', '=', parent.default_account_id)])",domain:[...f.domain,["deprecated","=",!1],"|",["account_type","in",["asset_current","liability_current"]],["id","=",{field_parent_default_account_id:{}}]]},ce={str:"(company_id and ['|', ('company_id', '=', False), ('company_id', 'parent_of', [company_id])] or ['|', ('company_id', '=', False), ('company_id', 'parent_of', [''])]) + ([('deprecated', '=', False),                 ('account_type', 'in', ('income', 'income_other'))])",domain:[...f.domain,["deprecated","=",!1],["account_type","in",["income","income_other"]]]},de={str:"(company_id and ['|', ('company_id', '=', False), ('company_id', 'parent_of', [company_id])] or []) + ([('deprecated', '=', False),                 ('account_type', 'in', ('income', 'income_other'))])",domain:[...f.domain,["deprecated","=",!1],["account_type","in",["income","income_other"]]]},_e={str:"(company_id and ['|', ('company_id', '=', False), ('company_id', 'parent_of', [company_id])] or ['|', ('company_id', '=', False), ('company_id', 'parent_of', [''])]) + ([('deprecated', '=', False),                 ('account_type', '=', 'expense')])",domain:[...f.domain,["deprecated","=",!1],["account_type","=","expense"]]},le={str:"(company_id and ['|', ('company_id', '=', False), ('company_id', 'parent_of', [company_id])] or []) + ([('deprecated', '=', False),                 ('account_type', '=', 'expense')])",domain:[...f.domain,["deprecated","=",!1],["account_type","=","expense"]]},me={str:"(company_id and ['|', ('company_id', '=', False), ('company_id', 'in', [company_id])] or [('company_id', '=', False)]) + ([('partner_id','=', company_partner_id)])",domain:[...m.domain,["partner_id","=",{field_company_partner_id:{}}]]},ue={str:"(company_id and ['|', ('company_id', '=', False), ('company_id', 'in', [company_id])] or []) + ([('partner_id','=', company_partner_id)])",domain:[...m.domain,["partner_id","=",{field_company_partner_id:{}}]]},pe={str:"[('account_type', '=', 'liability_payable'), ('deprecated', '=', False)]",domain:[["account_type","=","liability_payable"],["deprecated","=",!1]]},he={str:"[('account_type', '=', 'asset_receivable'), ('deprecated', '=', False)]",domain:[["account_type","=","asset_receivable"],["deprecated","=",!1]]},ye={str:"(company_id and ['|', ('company_id', '=', False), ('company_id', 'parent_of', [company_id])] or ['|', ('company_id', '=', False), ('company_id', 'parent_of', [''])]) + ([('id', 'in', suitable_journal_ids)])",domain:[...f.domain,["id","in",{field_suitable_journal_ids:{}}]]},fe={str:"(company_id and ['|', ('company_id', '=', False), ('company_id', 'parent_of', [company_id])] or []) + ([('id', 'in', suitable_journal_ids)])",domain:[...f.domain,["id","in",{field_suitable_journal_ids:{}}]]},ge={str:"[('id', 'in', suitable_journal_ids)]",domain:[["id","in",{field_suitable_journal_ids:{}}]]},be={str:"(company_id and ['|', ('company_id', '=', False), ('company_id', 'in', [company_id])] or [('company_id', '=', False)]) + ([('id', 'in', available_partner_bank_ids)])",domain:[...m.domain,["id","in",{field_available_partner_bank_ids:{}}]]},we={str:"(company_id and ['|', ('company_id', '=', False), ('company_id', 'in', [company_id])] or []) + ([('id', 'in', available_partner_bank_ids)])",domain:[...m.domain,["id","in",{field_available_partner_bank_ids:{}}]]},ve={str:"(company_id and ['|', ('company_id', '=', False), ('company_id', 'parent_of', [company_id])] or ['|', ('company_id', '=', False), ('company_id', 'parent_of', [''])]) + ([('type', 'in', ('bank','cash')), ('id', '!=', journal_id)])",domain:[...f.domain,["type","in",["bank","cash"]],["id","!=",{field_journal_id:{}}]]},je={str:"(company_id and ['|', ('company_id', '=', False), ('company_id', 'parent_of', [company_id])] or []) + ([('type', 'in', ('bank','cash')), ('id', '!=', journal_id)])",domain:[...f.domain,["type","in",["bank","cash"]],["id","!=",{field_journal_id:{}}]]},ke={str:"(company_id and ['|', ('company_id', '=', False), ('company_id', 'parent_of', [company_id])] or ['|', ('company_id', '=', False), ('company_id', 'parent_of', [''])]) + ([('type_tax_use', '=', 'sale')])",domain:["|",["company_id","=",!1],["company_id","parent_of",[{field_company_id:{}}]],["type_tax_use","=","sale"]]},xe={str:"(company_id and ['|', ('company_id', '=', False), ('company_id', 'parent_of', [company_id])] or []) + ([('type_tax_use', '=', 'sale')])",domain:[...f.domain,["type_tax_use","=","sale"]]},Fe={str:"[('model', '=', render_model)]",domain:[["model","=",{field_render_model:{}}]]},Oe={str:"(allowed_company_ids[0] and ['|', ('company_id', '=', False), ('company_id', 'in', [allowed_company_ids[0]])] or [('company_id', '=', False)]) + (['|', ('company_id', '=', False), ('company_id', '=', allowed_company_ids[0])])",domain:["|",["company_id","=",!1],["company_id","in",[{session_current_company_id:{}}]],"|",["company_id","=",!1],["company_id","=",{session_current_company_id:{}}]]},Me={str:"(allowed_company_ids[0] and ['|', ('company_id', '=', False), ('company_id', 'in', [allowed_company_ids[0]])] or []) + (['|', ('company_id', '=', False), ('company_id', '=', allowed_company_ids[0])])",domain:["|",["company_id","=",!1],["company_id","in",[{session_current_company_id:{}}]],"|",["company_id","=",!1],["company_id","=",{session_current_company_id:{}}]]},Ae={str:"(allowed_company_ids[0] and [('company_ids', 'in', [allowed_company_ids[0]])] or []) + ([])",domain:[["company_ids","in",{session_current_company_id:{}}]]},Se={str:"(allowed_company_ids[0] and ['|', ('company_id', '=', False), ('company_id', 'in', [allowed_company_ids[0]])] or [('company_id', '=', False)]) + ([('usage', '=', 'production'), '|', ('company_id', '=', False), ('company_id', '=', allowed_company_ids[0])])",domain:["|",["company_id","=",!1],["company_id","in",[{session_current_company_id:{}}]],["usage","=","production"],"|",["company_id","=",!1],["company_id","=",{session_current_company_id:{}}]]},$e={str:"(allowed_company_ids[0] and ['|', ('company_id', '=', False), ('company_id', 'in', [allowed_company_ids[0]])] or []) + ([('usage', '=', 'production'), '|', ('company_id', '=', False), ('company_id', '=', allowed_company_ids[0])])",domain:["|",["company_id","=",!1],["company_id","in",[{session_current_company_id:{}}]],["usage","=","production"],"|",["company_id","=",!1],["company_id","=",{session_current_company_id:{}}]]},Ee={str:"(allowed_company_ids[0] and ['|', ('company_id', '=', False), ('company_id', 'in', [allowed_company_ids[0]])] or [('company_id', '=', False)]) + ([('usage', '=', 'inventory'), '|', ('company_id', '=', False), ('company_id', '=', allowed_company_ids[0])])",domain:["|",["company_id","=",!1],["company_id","in",[{session_current_company_id:{}}]],["usage","=","inventory"],"|",["company_id","=",!1],["company_id","=",{session_current_company_id:{}}]]},Ne={str:"(allowed_company_ids[0] and ['|', ('company_id', '=', False), ('company_id', 'in', [allowed_company_ids[0]])] or []) + ([('usage', '=', 'inventory'), '|', ('company_id', '=', False), ('company_id', '=', allowed_company_ids[0])])",domain:["|",["company_id","=",!1],["company_id","in",[{session_current_company_id:{}}]],["usage","=","inventory"],"|",["company_id","=",!1],["company_id","=",{session_current_company_id:{}}]]},qe={str:"(company_id and ['|', ('company_id', '=', False), ('company_id', 'in', [company_id])] or [('company_id', '=', False)]) + ([('usage', '=', 'view'), ('company_id', '=', company_id)])",domain:[...m.domain,["usage","=","view"],["company_id","=",{field_company_id:{}}]]},Je={str:"(company_id and ['|', ('company_id', '=', False), ('company_id', 'in', [company_id])] or []) + ([('usage', '=', 'view'), ('company_id', '=', company_id)])",domain:[...m.domain,["usage","=","view"],["company_id","=",{field_company_id:{}}]]},De={str:"(company_id and ['|', ('company_id', '=', False), ('company_id', 'in', [company_id])] or [('company_id', '=', False)]) + ([('usage', '!=', 'view')])",domain:[...m.domain,["usage","!=","view"]]},Le={str:"(company_id and ['|', ('company_id', '=', False), ('company_id', 'in', [company_id])] or []) + ([('usage', '!=', 'view')])",domain:[...m.domain,["usage","!=","view"]]},Ce={str:"(company_id and ['|', ('company_id', '=', False), ('company_id', 'in', [company_id])] or [('company_id', '=', False)]) + ([('usage', '=', 'internal'), ('company_id', '=', company_id)])",domain:[...m.domain,["usage","=","internal"],["company_id","=",{field_company_id:{}}]]},Ue={str:"(company_id and ['|', ('company_id', '=', False), ('company_id', 'in', [company_id])] or [('company_id', '=', False)]) + ([('usage','=','internal')])",domain:[...m.domain,["usage","=","internal"]]},Re={str:"(company_id and ['|', ('company_id', '=', False), ('company_id', 'in', [company_id])] or []) + ([('usage', '=', 'internal'), ('company_id', '=', company_id)])",domain:[...m.domain,["usage","=","internal"],["company_id","=",{field_company_id:{}}]]},Te={str:"(company_id and ['|', ('company_id', '=', False), ('company_id', 'in', [company_id])] or [('company_id', '=', False)]) + ([('id', 'in', allowed_operation_ids)])",domain:[...m.domain,["id","in",{field_allowed_operation_ids:{}}]]},Ie={str:"[('id', 'in', possible_bom_product_template_attribute_value_ids)]",domain:[["id","in",{field_possible_bom_product_template_attribute_value_ids:{}}]]},ze={str:"(company_id and ['|', ('company_id', '=', False), ('company_id', 'in', [company_id])] or [('company_id', '=', False)]) + ([('code', '=', 'mrp_operation')])",domain:[...m.domain,["code","=","mrp_operation"]]},Pe={[c.str]:c.domain,[d.str]:d.domain,[_.str]:_.domain,[l.str]:l.domain,[m.str]:m.domain,[u.str]:u.domain,[p.str]:p.domain,[h.str]:h.domain,[y.str]:y.domain,[f.str]:f.domain,[g.str]:g.domain,[b.str]:b.domain,[w.str]:w.domain,[F.str]:F.domain,[O.str]:O.domain,[v.str]:v.domain,[j.str]:j.domain,[k.str]:k.domain,[x.str]:x.domain,[M.str]:M.domain,[A.str]:A.domain,[S.str]:S.domain,[$.str]:$.domain,[E.str]:E.domain,[N.str]:N.domain,[q.str]:q.domain,[J.str]:J.domain,[D.str]:D.domain,[L.str]:L.domain,[C.str]:C.domain,[U.str]:U.domain,[R.str]:R.domain,[T.str]:T.domain,[I.str]:I.domain,[z.str]:z.domain,[P.str]:P.domain,[Q.str]:Q.domain,[B.str]:B.domain,[G.str]:G.domain,[H.str]:H.domain,[K.str]:K.domain,[V.str]:V.domain,[W.str]:W.domain,[X.str]:X.domain,[Y.str]:Y.domain,[Z.str]:Z.domain,[ee.str]:ee.domain,[te.str]:te.domain,[ne.str]:ne.domain,[ae.str]:ae.domain,[oe.str]:oe.domain,[ie.str]:ie.domain,[se.str]:se.domain,[re.str]:re.domain,[ce.str]:ce.domain,[de.str]:de.domain,[_e.str]:_e.domain,[le.str]:le.domain,[me.str]:me.domain,[ue.str]:ue.domain,[pe.str]:pe.domain,[he.str]:he.domain,[ye.str]:ye.domain,[fe.str]:fe.domain,[ge.str]:ge.domain,[be.str]:be.domain,[we.str]:we.domain,[ve.str]:ve.domain,[je.str]:je.domain,[Fe.str]:Fe.domain,[ke.str]:ke.domain,[xe.str]:xe.domain,[Oe.str]:Oe.domain,[Me.str]:Me.domain,[Ae.str]:Ae.domain,[Se.str]:Se.domain,[$e.str]:$e.domain,[Ee.str]:Ee.domain,[Ne.str]:Ne.domain,[qe.str]:qe.domain,[Je.str]:Je.domain,[De.str]:De.domain,[Le.str]:Le.domain,[Ce.str]:Ce.domain,[Re.str]:Re.domain,[Ue.str]:Ue.domain,[Te.str]:Te.domain,[Ie.str]:Ie.domain,[ze.str]:ze.domain,aaaa:{}};class Qe{constructor(e,t={}){const{env:n,metadata_extend:a={}}=t;this._model=e,this._env=n,this.metadata_extend=a}context_get(e={}){const{context:t={}}=e;return{...this.env.context,...t}}async call_kw(e,t=[],n={}){const a=this.context_get(n),o={...n,context:a},i=this._env.rpc.web,s=this.model;return i.dataset.call_kw(s,e,t,o)}get model(){return this._model}get env(){return this._env}async call_button(e,t,n={}){const a=this.context_get(n),{action_map:o,record:i,records:s,...r}=n,c={...r,context:a},d=this._env.rpc.web,_=this.model,l=[t];return d.dataset.call_button(_,e,l,c)}}class Be extends Qe{constructor(...e){super(...e)}async _fields_get(e,t={}){const{attributes:n,context:a={}}=t,o=[e,n];return this.call_kw("fields_get",o,{context:a})}async fields_get(e,t={}){const n=await this._fields_get(e,t);return Object.keys(n).reduce(((e,t)=>{const a=this.metadata_extend[t]||{},o={...n[t],...a};if(o.relation){const n=function(e){const{meta:t,fname:n,Model:a}=e;if(!t.domain)return t;if(Array.isArray(t.domain))return t;if("string"!=typeof t.domain)return t;const o=t.domain.trim();if(o in Pe){const e=Pe[o];return{...t,domain:e}}return t}({meta:o,fname:t,Model:this});e[t]=n}else e[t]=o;return e}),{})}async search_count(e,t={}){const n=[e];return this.call_kw("search_count",n,t)}async search(e=[],t={}){const n=[e];return this.call_kw("search",n,t)}async search_one(e){const t=await this.search(e,{limit:1});return t.length>=1?t[0]:void 0}async name_search(e={}){return this.call_kw("name_search",[],e)}async name_get(e,t={}){const n=[e];return this.call_kw("name_get",n,t)}async search_read(e={}){return this.call_kw("search_read",[],e)}async web_search_read(e,t,n={}){const a=[e,t];return this.call_kw("web_search_read",a,n)}async web_read(e,t,n={}){const a=[e,t];return this.call_kw("web_read",a,n)}async read(e,t,n={}){const a=[e,t];return this.call_kw("read",a,n)}async read_one(e,t,n={}){const a=await this.read(e,t,n);return a.length?a[0]:{}}async onchange(e,t,n,a,o={}){const i=[e,t,n,a];return await this.call_kw("onchange",i,o)}async create(e,t={}){const n=[e];return this.call_kw("create",n,t)}async write(e,t,n={}){const a=[e,t];return this.call_kw("write",a,n)}async unlink(e){const t=[e];return this.call_kw("unlink",t)}async web_save(e,t,n,a={}){const o=[e,t,n];return this.call_kw("web_save",o,a)}}class Ge extends Be{constructor(e,t={}){super(e,t);const{metadata:n={}}=t;this._metadata=n}get metadata(){return this._metadata}set metadata(e){this._metadata={...e}}get _rec_names_search(){return["name"]}async _js_web2_name_search(e={}){const{fields:t={},args:n=[],name:a,limit:o=8,offset:i=0,order:s}=e,r=[...this._rec_names_search.reduce(((e,t)=>{const n=[t,"ilike",a];return 0===e.length?e.push(n):e=["|",...e,n],e}),[]),...n],c=Object.keys(t).length?t:{display_name:{}};"display_name"in t||(c.display_name={});const d=await this._js_web2_search_read(r,c,{offset:i,limit:o,order:s}),{length:_,records:l}=d;return{length:_,offset:i,limit:o,records:l}}async fields_get(e,t={}){const n=await super.fields_get(e,t);return Object.keys(n).reduce(((e,t)=>{const a=["many2many","one2many"].includes(n[t].type)?{metadata:{}}:{};return e[t]={...n[t],...a},e}),{})}async _js_web2_fields_get(e,t={}){const{callback:n,context:a}=t,o=()=>{n&&n(this.metadata)},i=Object.keys(e),s=await this.fields_get(i,{context:a}),r=Object.keys(s).reduce(((t,n)=>(t[n]={...s[n],...e[n]||{}},t)),{});this.metadata={...r},o();for(const t of i){const n=r[t];if(!n)continue;if(!["many2one","many2many","one2many"].includes(n.type))continue;const i=(e[t]||{}).fields;if(!i)continue;const s=this.env.model(n.relation),c=await s._js_web2_fields_get(i,{callback:e=>{this.metadata={...this.metadata,[t]:{...n,metadata:e}},o()},context:a});this.metadata={...this.metadata,[t]:{...n,metadata:c}},o()}return this.metadata}_js_fields_spec_for_onchange(e){const t=Object.keys(e).filter((t=>!(e[t]||{}).disable_field_onchange)).reduce(((t,n)=>{t[n]={};const a=e[n];if(["many2one","many2many","one2many"].includes(a.type)){const e=a.metadata||{},o=this._js_fields_spec_for_onchange(e);"display_name"in o||(o.display_name={}),t[n]={fields:o}}return t}),{});return this._js_format_fields_spec(t,{metadata:e})}_js_format_fields_spec(e,{metadata:t}){const n=e||{};return Object.keys(n).reduce(((n,a)=>{if(a in t){n[a]={};const o=t[a]||{};if(["many2one","many2many","one2many"].includes(o.type)){const t={...o.metadata||{}};Object.keys(t).length||(t.display_name={type:"char"});const i=((e||{})[a]||{}).fields||{display_name:{}},s=this._js_format_fields_spec(i,{metadata:t});n[a]={fields:s}}}else n[a]={};return n}),{})}async _js_web2_search_read(e,t,n={}){const a=this.metadata,o=this._js_format_fields_spec(t,{metadata:a}),i=await this.web_search_read(e,o,n),{length:s,records:r}=i;return{length:s,records:this._js_formatList(r,t,{metadata:a})}}async _js_web2_read(e,t,n={}){const a=this.metadata,o=this._js_format_fields_spec(t,{metadata:a}),i=await this.web_read(e,o,n);return this._js_formatList(i,t,{metadata:a})}async _js_web2_onchange(e,t,n,a={}){const o=this.metadata,i=this._js_fields_spec_for_onchange(o),s=[e,t,n,i,a],r=await this.onchange(...s),{value:c={},...d}=r;return{value:this._js_formatDict(c,i,{metadata:o,for_onchange:!0}),...d}}async _js_web2_save(e,t,n={}){const a=this.metadata,o=this._js_fields_spec_for_onchange(a),i=await this.web_save(e,t,o,n),s=this._js_formatList(i,o,{metadata:a});return s.length?s[0]:{}}_js_formatList(e,t,n={}){return e.map((e=>this._js_formatDict(e,t,n)))}_js_formatDict(e,t={},{metadata:n,for_onchange:a}){const o=(e,o)=>{const i=n[e]||{},s=t[e]||{};return"boolean"===i.type?o:"integer"===i.type||"float"===i.type||"monetary"===i.type?!1!==o?o:0:"many2one"===i.type?o?Array.isArray(o)?{id:o[0],display_name:o[1]}:this._js_formatDict(o,s.fields,{metadata:i.metadata||{}}):{id:null}:["many2many","one2many"].includes(i.type)?a?"many2many"===i.type?(console.log("tocheck, m2m, for_onchange:",e,o),this._js_formatDict_onchange_many2many(o,i)):(console.log("tocheck, O2M, for_onchange:",e,o),this._js_formatDict_onchange_one2many(o,i)):o.map((t=>"number"==typeof t?(console.log("tocheck, m2m/O2M, return number:",e,o),{id:t}):"object"==typeof t?this._js_formatDict(t,s.fields,{metadata:i.metadata||{}}):(console.log("tocheck, m2m/O2M, return error:",e,o),t))):(["reference","many2one_reference"].includes(i.type),o||null)};return Object.keys(e).reduce(((t,n)=>(t[n]=o(n,e[n]),t)),{})}_js_formatDict_onchange_many2many(e,t){const n=e.reduce(((t,n)=>{const[a,o,i]=n;return 5===a?t={}:6===a?t=i.reduce(((e,t)=>(e[t]={id:t},e)),{}):4===a?t[o]={id:o}:console.log("todo : _js_formatDict_onchange_many2many:",e),t}),{});return Object.values(n)}_js_formatDict_onchange_one2many(e,t){console.log("todo o2m, onchange1 return,",e,t);return e.map((e=>{const n=e[0];if(5===n)return[n,!1,!1];if(4===n){const t=e[1];return[n,t,{id:t}]}if(2===n){return[n,e[1],!1]}if(1===n||0===n){const a=e[1],o=e[2];return[n,a,this._js_formatDict(o,{},{metadata:t.metadata,for_onchange:1})]}return e}))}}class He extends Ge{constructor(e,t={}){super(e,t)}}class Ke extends He{constructor(e,t={}){super(e,t)}async _js16_web2_search_read(e,t,n={}){const{callback:a,...o}=n,i=Object.keys(t),s=await this.web_search_read(e,i,o),{length:r,records:c}=s,d=e=>{a&&a(e)},{context:_={}}=o,l=this._js16_formatList(c,this.metadata);d({length:r,records:l});return{length:r,records:await this._js16_web2_read_next(l,t,{callback:d,context:_})}}async _js16_web2_read(e,t,n={}){const{callback:a,...o}=n,i=Object.keys(t||this.metadata),s=await this.read(e,i,o),r=this._js16_formatList(s,this.metadata),c=e=>{a&&a(e)},{context:d={}}=o;return c(r),this._js16_web2_read_next(r,t,{callback:e=>c(e),context:d})}async _js16_web2_read_next(e,t,n={}){const{callback:a,context:o={}}=n;let i=e.reduce(((e,t)=>(e[t.id]=t,e)),{});const s=(t,n)=>{const o=this.metadata[t]||{},s=n.reduce(((e,t)=>(e[t.id]=t,e)),{});i=Object.keys(i).reduce(((e,n)=>{const a=i[n],r={...a};return["many2one"].includes(o.type)?a[t].id&&(r[t]=s[a[t].id]):r[t]=a[t].map((e=>s[e.id])),e[n]=r,e}),{});const r=e.map((e=>i[e.id]));a(r)},r=Object.keys(t).filter((e=>{const n=t[e]||{};if(n){if("object"==typeof n){if(n.fields)return!0;{const t=this.metadata[e]||{};return!!["many2many","one2many"].includes(t.type)}}{const e=this.metadata[n]||{};return!!["many2many"].includes(e.type)}}return!1})).reduce(((e,n)=>(e[n]={ids:[],fields:t[n].fields},e)),{});e.forEach((e=>{Object.keys(r).forEach((t=>{const n=e[t],a=this.metadata[t]||{};if(["many2many","one2many"].includes(a.type)){const e=n.map((e=>e.id)),a=[...r[t].ids,...e],o=[...new Set(a)];r[t].ids=o}else if(["many2one"].includes(a.type)){const e=n.id?[n.id]:[],a=[...r[t].ids,...e],o=[...new Set(a)];r[t].ids=o}}))}));for(const e of Object.keys(r)){const t=this.metadata[e]||{},n=r[e].ids;if(0===n.length);else if(t.metadata&&Object.keys(t.metadata).length){const a=this.env.model(t.relation,{metadata:t.metadata}),i=r[e].fields||{display_name:{}},c=await a._js16_web2_read(n,i,{callback:t=>{s(e,t)},context:o});s(e,c)}else{const a=this.env.model(t.relation),i=(await a.name_get(n,{context:o})).map((e=>({id:e[0],display_name:e[1]})));s(e,i)}}return e.map((e=>i[e.id]))}_js16_formatList(e,t){return e.map((e=>this._js16_formatDict(e,t)))}_js16_formatDict(e,t,n){const a=(e,a)=>{const o=t[e]||{};return"boolean"===o.type?a:"integer"===o.type||"float"===o.type||"monetary"===o.type?!1!==a?a:0:"many2one"===o.type?a?{id:a[0],display_name:a[1]}:{id:null}:["many2many","one2many"].includes(o.type)?n?"many2many"===o.type?(console.log("tocheck, m2m, for_onchange:",e,a),this._js_formatDict_onchange_many2many(a,o)):(console.log("tocheck, O2M, for_onchange:",e,a),this._js_formatDict_onchange_one2many(a,o)):a.map((e=>({id:e}))):a||null};return Object.keys(e).reduce(((t,n)=>(t[n]=a(n,e[n]),t)),{})}_js16_get_field_onchange(e){return Object.keys(e).filter((t=>!e[t].disable_field_onchange)).reduce(((t,n)=>{t[n]="1";const a=e[n];if("one2many"===a.type){const e=a.metadata,o=Object.keys(e).reduce(((e,t)=>(e[`${n}.${t}`]="1",e)),{});t={...t,...o}}return t}),{})}async _js16_web2_onchange(e,t,n,a={}){const o=[e,t,n,this._js16_get_field_onchange(this.metadata),a],i=await this.onchange(...o),{value:s,...r}=i;return{...r,value:await this._js16_web2_onchange_after(s,a)}}async _js16_web2_onchange_after(e,t={}){const n=this._js16_formatDict(e,this.metadata,!0),{context:a}=t,o={};for(const e of Object.keys(n)){const t=this.metadata[e]||{};if(["one2many"].includes(t.type))console.log("todo, onchange1 return o2m",e,n[e]),o[e]=n[e];else if(["many2many"].includes(t.type)){const i=n[e],s=i.map((e=>e.id));if(s.length){const n=this.env.model(t.relation,{metadata:t.metadata}),i=this._js_fields_spec_for_onchange(t.metadata),r=Object.keys(i).length>0?i:{display_name:{}},c=await n._js16_web2_read(s,r,{context:a});o[e]=c}else o[e]=i}else o[e]=n[e]}return o}async _js16_web2_save(e,t,n={}){if(e)return await this.write(e,t,n),{id:e};return{id:await this.create(t,n)}}async _js_web2_fields_get(e,t={}){return super._js_web2_fields_get(e,t)}async _js_web2_search_read(e,t,n={}){return this.env.server_version>16?super._js_web2_search_read(e,t,n):this._js16_web2_search_read(e,t,n)}async _js_web2_read(e,t,n={}){return this.env.server_version>16?super._js_web2_read(e,t,n):this._js16_web2_read(e,t,n)}async _js_web2_onchange(e,t,n,a={}){return this.env.server_version>16?super._js_web2_onchange(e,t,n,a):this._js16_web2_onchange(e,t,n,a)}async _js_web2_save(e,t,n={}){return this.env.server_version>16?super._js_web2_save(e,t,n):this._js16_web2_save(e,t,n)}}class Ve extends Ke{constructor(e,t={}){super(e,t)}async default_get(e,t={}){const n=[e];return this.call_kw("default_get",n,t)}async _js13_default_get_onchange(e,t={}){const n=Object.keys(this.metadata),a=await this.default_get(n,t),o={};for(const e of Object.keys(a)){const n=this.metadata[e],i=a[e];if(n&&n.relation&&"many2one"===n.type)if(i){const a=Array.isArray(i)?i:[i],s=(await this.env.model(n.relation).name_get(a,t))[0];o[e]=[...s]}else o[e]=i;else o[e]=i}const i=e=>{const t=this.metadata[e];return["many2many"].includes(t.type)?[[6,!1,[]]]:["one2many"].includes(t.type)?[]:["float","integer","monetary"].includes(t.type)?0:!!["text","html"].includes(t.type)&&""},s=[[],{...n.reduce(((e,t)=>(e[t]=i(t),e)),{}),...e,...a},n,this._js16_get_field_onchange(this.metadata),t],r=await this.onchange(...s),{value:c,...d}=r,_={...o,...c};return{...d,value:await this._js16_web2_onchange_after(_,t)}}async _js13_web2_onchange(e,t,n,a={}){return function(e){return!e||!(!Array.isArray(e)||e.length)}(n)?this._js13_default_get_onchange(t,a):super._js_web2_onchange(e,t,n,a)}async _js_web2_onchange(e,t,n,a={}){return this.env.server_version>13?super._js_web2_onchange(e,t,n,a):this._js13_web2_onchange(e,t,n,a)}}class We extends Ve{constructor(e,t={}){super(e,t)}}class Xe extends We{constructor(e,t={}){super(e,t)}async _rpc_web2_name_search(e={}){return this.call_kw("web2_name_search",[],e)}_rpc_web2_fields_get_after(e,t){const n=n=>{const a=t[n];if(["many2one","many2many","one2many"].includes(a.type)){if(0===Object.keys(a.metadata||{}).length)return a;{const t=this.env.model(a.relation),o=(e[n]||{}).fields||{};return{...a,metadata:t._rpc_web2_fields_get_after(o,a.metadata)}}}return a};return Object.keys(t).reduce(((t,a)=>{const o=n(a),i=this.metadata_extend[a]||{},s={},r=e[a]||{};return r.domain&&(s.domain=r.domain),r.selection&&(s.selection=r.selection),t[a]={...o,...i,...s},t}),{})}async _rpc_web2_fields_get_call(e,t={}){const{attributes:n,context:a={}}=t,o=[e,n];return this.call_kw("web2_fields_get",o,{context:a})}async _rpc_web2_fields_get(e,t={}){const n=await this._rpc_web2_fields_get_call(e,t),a=this._rpc_web2_fields_get_after(e,n);return this.metadata={...a},this.metadata}async _rpc_web2_search_read(e,t,n={}){const a=this.metadata,o=[e,this._js_format_fields_spec(t,{metadata:a})];return this.call_kw("web2_search_read",o,n)}async _rpc_web2_read(e,t,n={}){const a=this.metadata,o=[e,this._js_format_fields_spec(t,{metadata:a})];return this.call_kw("web2_read",o,n)}async _rpc_web2_onchange(e,t,n,a={}){const o=this.metadata,i=[e,t,n,this._js_fields_spec_for_onchange(o)];return await this.call_kw("web2_onchange",i,a)}async _rpc_web2_save(e,t,n={}){const a=this.metadata,o=[e,t,this._js_fields_spec_for_onchange(a)];return await this.call_kw("web2_save",o,n)}}class Ye extends Xe{constructor(e,t={}){super(e,t)}async web2_name_search(e={}){return this.env.run_by_server?this._rpc_web2_name_search(e):this._js_web2_name_search(e)}async web2_fields_get(e,t={}){const{context:n,callback:a}=t,o=function e(t){return Object.keys(t).reduce(((n,a)=>{const o={},i=t[a]||{};return i.fields&&(o.fields=e(i.fields)),i.domain&&(o.domain=i.domain),i.selection&&(o.selection=i.selection),n[a]=o,n}),{})}(e);return this.env.run_by_server?this._rpc_web2_fields_get(o,{context:n}):this._js_web2_fields_get(o,{callback:a,context:n})}async web2_search_read(e,t,n={}){const{callback:a,...o}=n;return this.env.run_by_server?this._rpc_web2_search_read(e,t,o):this._js_web2_search_read(e,t,n)}async web2_read(e,t,n={}){const{callback:a,...o}=n;return this.env.run_by_server?this._rpc_web2_read(e,t,o):this._js_web2_read(e,t,n)}async web2_read_one(e,t,n={}){const a=e=>e.length>0?e[0]:{},{callback:o,...i}=n,s=o?e=>o(a(e)):void 0,r=await this.web2_read(e,t,{callback:s,...i});return a(r)}async web2_onchange(e,t,n,a={}){return this.env.run_by_server?this._rpc_web2_onchange(e,t,n,a):this._js_web2_onchange(e,t,n,a)}async web2_save(e,t,n={}){return this.env.run_by_server?this._rpc_web2_save(e,t,n):this._js_web2_save(e,t,n)}}class Ze extends Ye{constructor(e,t={}){super(e,t)}get_fields_all(e){return Object.keys(e).filter((t=>!e[t].invisible)).reduce(((t,n)=>{const a=this.metadata[n]||{};return t[n]={meta:a,name:n,...e[n]},t}),{})}_load_metadata_after(e,t){return Object.keys(e).reduce(((n,a)=>{if(a in t){const o=t[a];if(o.relation&&e[a].fields){const t=this.env.model(o.relation)._load_metadata_after(e[a].fields,o.metadata);n[a]={...o,metadata:t}}else n[a]=o}else{const e=this.metadata_extend;if(!(a in e))throw console.log(this.model,a,e),"error, field name, "+this.model+" "+a;const t=e[a],o={...t,name:a,readonly:!t.inverse};this._metadata[a]=o,n[a]=o}return n}),{})}async load_metadata(e){const{fields:t,...n}=e,a=await this.web2_fields_get(t,n),o=this._load_metadata_after(t,a);return this.metadata={...o},o}_fields_remove(e){return Object.keys(e).reduce(((t,n)=>{const a=this.metadata[n];if(a.odoojs_extend);else{const o=e[n];if(a.relation&&"fields"in o){const e=this.env.model(a.relation,{metadata:a.metadata})._fields_remove(o.fields);t[n]={...o,fields:e}}else t[n]=o}return t}),{})}_load_web_before(e={}){const{fields:t}=e,n=this._fields_remove(t);return{...e,fields:n}}_load_web_after(e,{fields:t,context:n}){const a=(Array.isArray(e)?e:[e]).map((e=>{let a={...e};const o={};return Object.keys(t).forEach((i=>{const s=this.metadata[i];if(i in e){const o=t[i].fields;o&&(a[i]=this.env.model(s.relation,{metadata:s.metadata})._load_web_after(e[i],{fields:o,context:n}))}else s.compute&&this[s.compute]&&(o[s.compute]=1)})),Object.keys(o).forEach((t=>{const o=this[t]({record:e,context:n});a={...a,...o}})),a}));return Array.isArray(e)?a:a[0]}async load_web_data(e={}){const t=this._load_web_before(e),{domain:n=[],fields:a,...o}=t,i=await this.web2_search_read(n,a,o),{fields:s,context:r={}}=e,{length:c,records:d}=i;return{length:c,records:this._load_web_after(d,{fields:s,context:r})}}async load_data_one(e,t={}){const n=this._load_web_before(t),{fields:a,...o}=n,i=await this.web2_read_one(e,a,o),{fields:s,context:r={}}=t;return this._load_web_after(i,{fields:s,context:r})}async load_data(e={}){const{records:t}=await this.load_web_data(e);return t}async call_onchange(e,t,n,a={}){return this.web2_onchange(e,t,n,a)}async call_commit(e,t,n={}){return this.web2_save(e,t,n)}}const et={"ir.model.data":{ModelCreator:function(e){return class extends e{constructor(...e){super(...e)}async model_find_or_create(e,t,n){const a=await this.env.model(e),o=await a.search_one(t);return o||a.create(n)}async ref_model_find_or_create(e,t,n){return{model:e,id:await this.model_find_or_create(e,t,n)}}async ref(e){const[t,n]=e.split("."),a=[t,n,!0],[o,i]=await this.call_kw("check_object_reference",a);return{model:o,id:i}}}}}};const tt={"res.country":{ModelCreator:function(e){return class extends e{constructor(...e){super(...e)}get _rec_names_search(){return["name","code"]}async web2_name_search(e={}){const t=await super.web2_name_search({...e,fields:{display_name:{},name:{},code:{}},order:"code"}),{records:n}=t,a=n.map((e=>({...e,display_name:`${e.code} ${e.name}`})));return{...t,records:a}}async name_search(e={}){const{name:t,args:n=[],limit:a}=e,o=(()=>{if(t){return[...["|",["name","ilike",t],["code","ilike",t]],...n]}return n})();return(await this.search_read({domain:o,fields:["name","code"],limit:a,order:"code"})).map((e=>[e.id,`${e.code} ${e.name}`]))}}},metadata:{name:{testdomain:()=>[]}}},"res.country.state":{ModelCreator:function(e){return class extends e{constructor(...e){super(...e)}}},metadata:{}}};const nt={"res.partner.category":{ModelCreator:function(e){return class extends e{constructor(...e){super(...e)}}},metadata:{display_name:{disable_field_onchange:1},parent_id:{domain:[["id","!=",{field_id:{}}]]}}}};const at={"res.bank":{ModelCreator:function(e){return class extends e{constructor(...e){super(...e)}}},metadata:{}}};const ot={"account.analytic.line":{ModelCreator:function(e){return class extends e{constructor(...e){super(...e)}async fields_get(e,t={}){const n=await super.fields_get(e,t);if(!("account_id"in n))return n;const{account_id:a}=n;if(!("domain"in a))return n;const o=n.account_id.domain;console.log("todo: account.analytic.line fields_get",o);return{...n,account_id:{...a,domain:[["plan_id","child_of",1]]}}}}},metadata:{}}};const it={"account.account":{ModelCreator:function(e){return class extends e{constructor(...e){super(...e)}get _rec_names_search(){return["name","code"]}}},metadata:{}}};const st={"account.payment":{ModelCreator:function(e){return class extends e{constructor(...e){super(...e)}async onchange(e,t,n,a,o={}){const{context:i={}}=o,{default_is_internal_transfer:s}=i,r=await super.onchange(e,t,n,a,o);return s&&Array.isArray(n)&&!n.length?(console.log("todo: account.payment onchange for_new_internal_transfer"),r):r}}},metadata:{}}};const rt={base:{models:{...et,...tt,...nt,...at}},contacts:{depends:["base","mail"],models:{}},uom:{depends:["base"],models:{}},product:{depends:["base","mail","uom"],models:{}},analytic:{depends:["base","mail","uom"],models:{...ot}},account:{depends:["base_setup","product","analytic","portal","digest"],models:{...it,...st}},account_payment:{depends:["account","payment"],models:{}},sales_team:{depends:["base","mail"],models:{}},sale:{depends:["sales_team","account_payment","utm"],models:{...{"sale.order":{metadata:{user_id:{domain:[["share","=",!1],["company_ids","=",{field_company_id:{}}]],async async_domain({env:e}){const t=await e.ref("sales_team.group_sale_salesman").id;return({record:e})=>{const{company_id:n}=e;return[["groups_id","=",t],["share","=",!1],["company_ids","=",n]]}}}}}}}},purchase:{depends:["account"],models:{}},stock:{depends:["product","barcodes_gs1_nomenclature","digest"],models:{...{"stock.quant":{metadata:{product_id:{domain:[]},location_id:{domain:[]},lot_id:{domain:[]},package_id:{domain:[]},owner_id:{domain:[]}}}}}},mrp:{models:{...{"mrp.production":{metadata:{bom_id:{domain:[]}}}}}}};function ct(e){return"string"==typeof e}class dt{constructor(){this.queue=[],this.call_id=0}async wait_call(){const e=[...this.queue],t=[...e];let n=t.shift();for(;n;)await n.result,n=t.shift();e.forEach((e=>{const t=this.queue.findIndex((t=>t.call_id===e.call_id));t>=0&&this.queue.splice(t,1)}))}append(e){const t=this.call_id+1;this.call_id=t,this.queue.push({call_id:t,result:e})}}class _t{constructor(e,t={}){const{env:n,metadata:a,context:o={}}=t;this._model=e,this._env=n,this._metadata=a,this._context=o,this.datastore={record:{},values:{}},this.changeQueue=new dt}get model(){return this._model}get Model(){return this._env.model(this._model,{metadata:this.metadata})}get env(){return this._env}get context(){return this._context}get metadata(){return this._metadata}get record_display(){return this._merge_to_display({...this.datastore.record},{...this.datastore.values})}set_edit({record:e={},values:t={}}){return this.datastore={record:{...e},values:{...t}},this.record_display}async _onchange(e,t){}async _wait(){await this.changeQueue.wait_call()}async onchange_by_wait(e,t){return await this._wait(),await this._onchange(e,t)}async onchange(e,t){const n=this.onchange_by_wait(e,t);return this.changeQueue.append(n),n}async _commit(){}async commit_by_wait(e){await this._wait();const t=await(n=e,!n||new Promise((e=>{n((t=>{e(t)}))})));var n;return t?await this._commit():void console.log("validate err",t)}async commit(e){return this.commit_by_wait(e)}}class lt extends _t{constructor(e,t={}){super(e,{...t})}_merge_data(e={},t={}){return Object.keys({...e,...t}).reduce(((n,a)=>{const o=this.metadata[a]||{};if("many2many"===o.type)n[a]=a in t?t[a]:a in e?e[a]:[];else if("one2many"===o.type){const i=this.env.one2many(o,{context:this.context})._merge_data(e[a],t[a]);n[a]=i}else{const o=a in t?t[a]:e[a];n[a]=o}return n}),{})}_merge_to_display(e={},t={}){const n=this._merge_data(e,t);let a=Object.keys(n).reduce(((e,t)=>{const a=this.metadata[t]||{};if("one2many"===a.type){const o=this.env.one2many(a,{context:this.context})._merge_to_display(n[t]);e[t]=o}else e[t]=n[t];return e}),{});const o={};return Object.keys(this.metadata).forEach((e=>{const t=this.metadata[e];t.odoojs_extend&&t.compute&&this.Model[t.compute]&&(o[t.compute]=1)})),Object.keys(o).forEach((e=>{const t=this.context,n=this.Model[e]({record:a,context:t});a={...a,...n}})),a}_merge_to_modifiers(e={},t={}){const n=this._merge_data(e,t);return Object.keys(n).reduce(((e,t)=>{const a=this.metadata[t]||{};if(["many2many"].includes(a.type)){const a=n[t].map((e=>e.id));e[t]=a}else if(["one2many"].includes(a.type)){const o=this.env.one2many(a,{context:this.context})._merge_to_modifiers(n[t]);e[t]=o}else["many2one"].includes(a.type)?e[t]=n[t].id:e[t]=n[t];return e}),{})}_merge_to_onchange(e={},t={}){const n=this._merge_data(e,t);return Object.keys(n).reduce(((e,t)=>{const a=this.metadata[t]||{};if("id"===t){const a=n[t];ct(a)||(e[t]=a)}else if(a.odoojs_extend);else if("many2many"===a.type)e[t]=[[6,!1,n[t].map((e=>e.id))]];else if("one2many"===a.type){const o=this.env.one2many(a,{context:this.context})._merge_to_onchange(n[t]);e[t]=o}else"many2one"===a.type?e[t]=n[t].id:e[t]=n[t];return e}),{})}_merge_values(e={},t={}){return this._merge_after_onchange(e,t)}_merge_after_onchange(e={},t={}){return Object.keys({...e,...t}).reduce(((n,a)=>{const o=this.metadata[a]||{};if("one2many"===o.type){const i=this.env.one2many(o,{context:this.context}),s=[...e[a]||[],...t[a]||[]],r=i._merge_values(s);n[a]=r}else{const o=a in t?t[a]:e[a];n[a]=o}return n}),{})}_merge_to_write(e={},t={}){const n=Object.keys(t),a=this._merge_to_modifiers(e,t);return n.reduce(((e,n)=>{const o=this.metadata[n]||{},i=function(e,t){const n=t=>"function"==typeof e.readonly?e.readonly({record:t}):e.readonly,a=t.state;if(void 0===e.states)return n(t);if(a&&e.states&&e.states[a]){const t=e.states[a].reduce(((e,t)=>(e[t[0]]=t[1],e)),{});if(void 0!==t.readonly)return t.readonly}return n(t)}(o,a);if(i);else if("one2many"===o.type){const a=this.env.one2many(o,{context:this.context})._merge_to_write(t[n]);e[n]=a}else if("many2many"===o.type){const a=t[n];e[n]=[[6,!1,a.map((e=>e.id))]]}else if("many2one"===o.type){const a=t[n];e[n]=a.id}else{const a=t[n];e[n]=a}return e}),{})}}class mt extends lt{constructor(e,t={}){super(e,{...t})}async _onchange(e,t){if(!e)return this._onchange_new();if(this.metadata[e].odoojs_extend)return this._onchange_odoojs(e,t);{const n=()=>{const n=this.metadata[e]||{};if("one2many"===n.type){return this.env.one2many(n,{context:this.context})._split_for_write(t)}return t},a={[e]:n()};return this._onchange_merge_me(a),this._onchange_old([e])}}async _onchange_merge_me(e){const t=this.datastore,n=t.values,a=this._merge_after_onchange(n,e);t.values={...t.values,...a}}async _onchange_odoojs(e,t){const n=this.metadata[e],a=await this.Model[n.inverse]({field_name:e,value:t,...this.datastore,record_display:this.record_display}),{value:o={}}=a;this._onchange_merge_me(o);const i=Object.keys(o);return this._onchange_old(i)}_onchange_values_for_parent(){return{}}async call_onchange(e,t,n){const a=this.context,o=Array.isArray(n)?n:[n];return await this.Model.call_onchange(e,t,o,{context:a})}async _onchange_new(){const e=this.datastore,t=e.record,n=e.values,a={...this._merge_to_onchange(t,n),...this._onchange_values_for_parent()},o=await this.call_onchange([],a,[]),{value:i,domain:s={}}=o,r={...i};for(const e of Object.keys(this.metadata)){const t=this.metadata[e];e in r||("many2one"===t.type?r[e]={id:null}:["many2many","one2many"].includes(t.type)?r[e]=[]:r[e]=null)}return e.values={...e.values,...r},{values:e.values,domain:s,record_display:this.record_display}}async _onchange_old(e){if(!e.length)return{values:this.datastore.values,record_display:this.record_display};const t=this.datastore,n=t.record,a=t.values,o=n.id&&!ct(n.id)?[n.id]:[],i={...this._merge_to_onchange(n,a),...this._onchange_values_for_parent()},s=await this.call_onchange(o,i,e),{value:r,domain:c={}}=s;return t.values=this._merge_after_onchange(t.values,r),{values:t.values,domain:c,record_display:this.record_display}}}class ut extends mt{constructor(...e){super(...e)}async _commit(){const e=this.datastore,t=e.record,n=e.values;console.log("commit",e);const a=t.id,o=this._merge_to_write(t,n);console.log("commit",t,n,o);const i=this.context;return(await this.Model.call_commit(a,o,{context:i})).id}get_fields_all(e){const t=this.Model.get_fields_all(e),n=this;return Object.keys(t).reduce(((e,a)=>{e[a]={...t[a]};const o=function(e){const{meta:t}=e,a="domain";if(!(a in t))return;const o=a in e?e[a]:t[a];if("function"==typeof o){const{record:e,values:t}=n.datastore;return o({record:n._merge_to_modifiers(e,t),context:n.context})}return o}(t[a]);return o&&(e[a].domain=o),e}),{})}}class pt extends mt{constructor(e,t={}){const{field_info:n,...a}=t;super(e,{...a,metadata:n.metadata}),this.field_info=n,this.parent_info={}}set_edit(e){const{parent_info:t}=e,n=super.set_edit(e);return this.parent_info={...t},n}_onchange_values_for_parent(){const e=this.parent_info,{metadata:t,model:n,record:a,values:o}=e,i=this.env.editmodel(n,{metadata:t})._merge_to_onchange(a,o),{relation_field:s}=this.field_info;return{[s]:i}}async _commit(){return{values:this.datastore.values,record_display:this.record_display}}get_fields_all(e){const t=this.Model.get_fields_all(e),n=this;function a(e){const{meta:t}=e,a="domain";if(!(a in t))return;const o=a in e?e[a]:t[a];if("function"==typeof o){const{record:e,values:t}=n.datastore,a=n._merge_to_modifiers(e,t),i=function(){const e=n.parent_info,{metadata:t,model:a,record:o,values:i}=e;return n.env.editmodel(a,{metadata:t})._merge_to_modifiers(o,i)}();return o({record:{...a,parent:i},context:n.context})}return o}return Object.keys(t).reduce(((e,n)=>{e[n]={...t[n]};const o=a(t[n]);return o&&(e[n].domain=o),e}),{})}}class ht{constructor(e,t={}){const{env:n,context:a={}}=t;this.field_info=e,this._env=n,this._context=a,this.Model=n.model(e.relation,{metadata:e.metadata})}get env(){return this._env}get context(){return this._context}}class yt extends ht{constructor(e,t={}){super(e,t)}async load_select_options(e={}){const{record:t={},...n}=e,a=await(()=>{const{domain:e,async_domain:n}=this.field_info;return n&&"function"==typeof n?n({record:t,env:this.env}):e})(),{args:o=[],limit:i=8,...s}=n;return this.Model.web2_name_search({args:[...o,...a],limit:i,...s})}}class ft extends ht{constructor(e,t={}){super(e,t)}}class gt extends ht{constructor(e,t={}){super(e,t),this.Editmodel=this.env.editx2m(e.relation,{field_info:e,context:this.context}),this.datastore={records:[],values:[]}}get records_display(){const e=this._merge_data(this.datastore.records,this.datastore.values);return this._merge_to_display(e)}get records_edit(){return this._merge_data(this.datastore.records,this.datastore.values)}set_edit({records:e=[],values:t=[]}){return this.datastore.records=[...e],this.datastore.values=[...t],this.records_display}_split_for_write(e=[]){return e.filter((e=>[2,1,0].includes(e[0])))}_merge_values(e=[]){const t=e.reduce(((e,t)=>{const[n,a,o]=t,i=0===n?a||bt.virtual_id():a;if(5===n)e={};else{const a=e[i];if(a){const[s,r,c]=a;if(2===s);else if(1===s&&2===n)e[i]=t;else if(0===s&&2===n)delete e[i];else if(1===s||0===s){const t=this.Editmodel._merge_values(c,o);e[i]=[s,r,t]}}else e[i]=[n,i,o]}return e}),{});return Object.values(t)}_merge_data(e=[],t=[]){return[...e.map((e=>[4,e.id,e])),...t]}_merge_to_modifiers(e=[]){const t=e.reduce(((e,t)=>{const[n,a,o]=t;return 5===n?e={}:[3,2].includes(n)?delete e[a]:([4].includes(n)||[1].includes(n)||[0].includes(n))&&(e[a]=a),e}),{});return Object.values(t)}_merge_to_display(e=[]){const t=e.reduce(((e,t)=>{const[n,a,o]=t;if(5===n)e={};else if([3,2].includes(n))delete e[a];else if([4].includes(n))e[a]=this.Editmodel._merge_to_display(o,{});else if([1].includes(n)){const t=e[a]||{};e[a]=this.Editmodel._merge_to_display(t,o)}else if([0].includes(n)){const t=this.Editmodel._merge_to_display({},o);e[a]={id:a,...t}}return e}),{});return Object.values(t)}_merge_to_onchange(e=[]){const t=e.reduce(((e,t)=>{const[n,a,o]=t;if(5===n)e={};else if([4].includes(n))e[a]=[n,a,o];else if([3,2].includes(n))e[a]=[n,a,!1];else if([1].includes(n)){const t=(e[a]||[null,null,{}])[2],i=this.Editmodel._merge_to_onchange(t,o);"id"in i&&delete i.id,e[a]=[n,a,i]}else if([0].includes(n)){const t=this.Editmodel._merge_to_onchange({},o);e[a]=[n,a,t]}return e}),{});return Object.values(t).map((e=>4===e[0]?[4,e[1],!1]:1===e[0]&&bt.is_virtual(e[1])?[0,e[1],e[2]]:e))}_merge_to_write(e=[]){return e.filter((e=>[2,1,0].includes(e[0]))).map((e=>{const[t,n,a]=e;if(2===t)return e;if(1===t||0===t){return[t,n,this.Editmodel._merge_to_write({},a)]}return e}))}upinsert_one(e,t){const n=e?bt.is_virtual(e)?[0,e,t]:[1,e,t]:[0,bt.virtual_id(),t],a=this._merge_values([...this.datastore.values,n]);return this.datastore.values=a,{values:this.datastore.values,records_display:this.records_display}}remove_one(e){const t=[2,e,!1],n=this._merge_values([...this.datastore.values,t]);return this.datastore.values=n,{values:this.datastore.values,records_display:this.records_display}}}const bt={_virtual_id:1,virtual_id(){this._virtual_id=this._virtual_id+1;return`virtual_${this._virtual_id}`},is_virtual:e=>"string"==typeof e},wt={get_one_depends(e,t){return e.reduce(((e,n)=>{if(n in t){const a=this.get_one_depends(t[n].depends||[],t);e={...e,...a}}return e[n]=null,e}),{})},get_all_depends(e){return Object.keys(e).reduce(((t,n)=>{const a=this.get_one_depends(e[n].depends||[],e);return t[n]=Object.keys(a).filter((t=>t in e)),t}),{})},compute_rank(e,t){if(t[e].length){const n=t[e].map((e=>this.compute_rank(e,t)));return Math.max(...n)+1}return 0},get_depends_rank(e){const t=this.get_all_depends(e);return Object.keys(t).reduce(((e,n)=>(e[n]=this.compute_rank(n,t),e)),{})},get_modules_order(e){const t=this.get_depends_rank(e);return Object.keys(t).sort(((e,n)=>t[e]-t[n]))}};function vt(e){const t=Object.keys(e).reverse().reduce(((t,n)=>({...t,...e[n]})),{});return wt.get_modules_order(t)}function jt(e,t,n,a){return Object.values(a).reduce(((t,a)=>function(e,t,n,a){return n.filter((t=>{const n=(a[t]||{}).models||{};return e in n&&n[e].metadata})).map((t=>(a[t]||{}).models[e].metadata)).reduce(((e,t)=>e={...e,...t}),t)}(e,t,n,a)),t)}class kt{constructor(e={}){const{rpc:t}=e;this.rpc=t}get run_by_server(){return this.rpc.run_by_server}get uid(){return this.rpc.web.session.session_info.uid}get web(){return this.rpc.web}get user(){const e=this.rpc.web.session.session_info;return{uid:e.uid,username:e.username,name:e.name}}get session(){return this.rpc.web.session}get server_version(){return((this.rpc.web.session.session_info||{}).server_version_info||[0])[0]}get cids_local(){return this.web.session.cids_local}set cids_local(e){this.web.session.cids_local=e}set_cids(e){this.cids_local=e}get context(){const e=this.cids_local;return{...this.rpc.web.session.user_context,allowed_company_ids:e}}load_session(){return{...this.web.session.session_info||{},cids:this.cids_local}}async ref(e){return this.model("ir.model.data").ref(e)}editmodel(e,t={}){return new ut(e,{...t,env:this})}editx2m(e,t={}){return new pt(e,{...t,env:this})}relation(e){return new yt(e,{env:this})}one2many(e,t={}){const n=this;const a=function(){if(!("metadata"in e))return e;const t={_odoojs_modules:rt,...n.rpc._addons_models},a=vt(t),o=jt(e.relation,{},a,t);return{...e,metadata:Object.keys(e.metadata).reduce(((t,n)=>(t[n]={...e.metadata[n],...o[n]||{}},t)),{})}}();return new gt(a,{...t,env:this})}many2many(e){return new ft(e,{env:this})}model(e,t={}){const n={_odoojs_modules:rt,...this.rpc._addons_models},a=vt(n),o=function(e,t,n,a){return Object.values(a).reduce(((t,a)=>function(e,t,n,a){const o=n.filter((t=>{const n=(a[t]||{}).models||{};return e in n&&n[e].ModelCreator})).map((t=>(a[t]||{}).models[e].ModelCreator));if(o.length){const e=o.reduce(((e,t)=>t(e)),t);return e}return t}(e,t,n,a)),t)}(e,Ze,a,n);return new o(e,{...t,env:this,metadata_extend:jt(e,{},a,n)})}}let xt=class{constructor(t){const{debug:n,run_by_server:a}=t;this.debug=n,this.run_by_server_of_config=a,this.run_by_server=!1;const{Request:o,baseURL:i,timeout:s,messageError:c}=t;this.baseURL=i;const d=new e({Request:o,baseURL:i,timeout:s,messageError:c}),_=new r({jsonrpc:d}),l=new kt({rpc:this});this.web=_.web,this.env=l,this._addons_models=[]}async after_session(){if(!this.run_by_server_of_config)return;(await this.env.model("ir.module.module").search_read({domain:[["state","!=","uninstalled"],["name","=","web_for_odoojs"]],fields:["name"]})).length&&(this.run_by_server=this.run_by_server_of_config)}async login({db:e,login:t,password:n}){const a={db:e,login:t,password:n},o=await this.web.session.authenticate(a);return o&&await this.after_session(),o}async session_check(){const e=await this.web.session.session_check();return e&&await this.after_session(),e}async logout(){return await this.web.session.logout()}};function Ft(e,t){return 0===e.length&&0===t.length||!e.length&&!t.length&&(e.length===t.length&&e.reduce(((e,n)=>e=e&&t.includes(n)),!0))}function Ot(e,t){if(["string","number"].includes(typeof t))return e===t;if("boolean"==typeof t){const n=!!e;return t?n:!n}return Array.isArray(t)?Ft(e,t):e===t}function Mt(e,t){if(["string","number"].includes(typeof t))return e!==t;if("boolean"==typeof t){const n=!!e;return t?!n:n}return Array.isArray(t)?!Ft(e,t):e!==t}function At(e,t){return e>t}function St(e,t){return e>=t}function $t(e,t){return e<t}function Et(e,t){return e<=t}function Nt(e,t){return t.includes(e)}function qt(e,t){return!t.includes(e)}function Jt(e,{root:t,...n}){let a=[...e];const[o,...i]=a;if("string"==typeof o){if("&"===o){if(0===i.length)throw"error and:"+JSON.stringify(t);const[e,a]=Jt(i,{root:t,...n});if(0===a.length)throw"error and:"+JSON.stringify(t);const[o,s]=Jt(a,{root:t,...n});return[e&&o,s]}if("|"===o){if(0===i.length)throw"error and:"+JSON.stringify(t);const[e,a]=Jt(i,{root:t,...n});if(0===a.length)throw"error and:"+JSON.stringify(t);const[o,s]=Jt(a,{root:t,...n});return[e||o,s]}if("!"===o){if(0===i.length)throw"error and:"+JSON.stringify(t);const[e,a]=Jt(i,{root:t,...n});return[!e,a]}throw"error uknow:"+JSON.stringify(t)}if(Array.isArray(o)){const e=function(e,{root:t,...n}){const{editable:a,record:o,context:i}=n,[s,r,c]=e,d={"=":Ot,"!=":Mt,">":At,">=":St,"<":$t,"<=":Et,in:Nt,"not in":qt},_=function(){if("string"==typeof s)return"parent."===s.slice(0,7)?o.parent[s.slice(7)]:o[s];if(s){if("object"==typeof s)return Dt(s,{...n});throw console.log("error, make_expression, ",e,s),"error,make_expression: "+JSON.stringify(e)}throw console.log("error, make_expression, ",e),"error,make_expression: "+JSON.stringify(e)}();return d[r](_,c)}(o,{root:t,...n});return[e,i]}if("boolean"==typeof o)return[o,i];if(o){if("object"==typeof o){return[Dt(o,{root:e,...n}),i]}throw"error object:"+JSON.stringify(t)}throw console.log("error: make_eval_array_one",e,n),"error:"+JSON.stringify(t)}function Dt(e,{root:t,...n}){const a=Object.keys(e);if(1!==a.length)throw"error make_eval_object"+JSON.stringify(e);const o=a[0],i=e[o];const[s,r]=function(e){const t=e.split("_");return[t[0],t.splice(1).join("_")]}(o);if("context"===s){const{context:e}=n;return r in e?e[r]:i}if("editable"===s){const{editable:e}=n;return e?i:!i}if("field"===s){const{record:e}=n;return e[r]}if("session"===s){const{env:e}=n;if(e.session[r])return e.session[r];throw console.log("make_eval_object",i),"error"}throw console.log("make_eval_object:",s,e),"error make_eval_object"+JSON.stringify(e)}const Lt={eval_array(e,t={}){const n=function(e,{root:t,...n}){if(!e.length)return!1;const[a,o]=Jt(e,{root:t,...n});let i=a,s=[...o],r=0;for(;s.length&&r<100;){const[e,a]=Jt(s,{root:t,...n});i=i&&e,s=[...a],r+=1}if(r>90)throw"error"+JSON.stringify(e);return i}(e,{root:e,...t});return n},eval_object:(e,t={})=>Dt(e,{root:e,...t})};const Ct={domain_maker(e,t={}){const n=function(e,t={}){const{env:n,meta:a,record:o,context:i,self:s}=t;function r(e){if("self"in e)return s;const[n,...a]=Object.keys(e)[0].split("_"),i=a.join("_");if(!i)throw console.log("get_domain1,",e),"error get_domain1";if("unknow"===n)throw console.log("get_domain1",e),"error";if("context"===n)throw console.log("get_domain1 context",e),"error";if("datetime"===n)throw console.log("get_domain1 datetime",e),"error";if("session"===n){const{env:n}=t;if(n.session[i])return n.session[i];throw console.log("get_domain1",e),"error"}if("field"===n){const[e,...t]=i.split("_"),n=t.join("_");if("parent"===e)return o[e][n];{const e=o[i];return"id"!==i||e?e:0}}throw console.log("get_domain1",e),"error"}if("string"==typeof e)throw console.log("domain is string. not an array",a.name,e),"domain is string. not an array: "+a.name+", "+e;if("function"==typeof e)throw console.log("domain is function. not an array"),"domain is function. not an array: "+a.name;return e.map((e=>{if(Array.isArray(e)){const[t,n,a]=e;return a?["number","boolean","string"].includes(typeof a)?e:Array.isArray(a)?[t,n,a.map((e=>{if(["number","string","boolean"].includes(typeof e))return e;if("object"==typeof e)return r(e);throw"error"}))]:"object"!=typeof a?e:[t,n,r(a)]:e}return e}))}(e,{...t});return n}};function Ut(e,{editable:t,record:n,context:a}){if("boolean"==typeof e)return e;if("number"==typeof e)return!!e;if("string"==typeof e){const t=Number(e);if(Number.isNaN(t))throw console.log("eval_modifiers. doing",e,typeof e),"error modifiers string: "+JSON.stringify(e);return!!e}if("function"==typeof e)throw console.log("eval_modifiers. doing",e,typeof e),"error modifiers: "+JSON.stringify(e);if(Array.isArray(e))return Lt.eval_array(e,{editable:t,record:n,context:a});if(void 0===e)return console.log("eval_modifiers. undefined",e,typeof e),e;if("object"==typeof e)return Lt.eval_object(e,{editable:t,record:n,context:a});throw console.log("eval_modifiers. doing",e,typeof e),"error modifiers: "+JSON.stringify(e)}function Rt(e,t){const{for_view:n,user_groups:a,editable:o,record:i,context:s}=t;return"groups"in e&&!function(e,{user_groups:t}){return!e||e.split(",").reduce(((e,n)=>e&&t.includes(n)),!0)}(e.groups,{user_groups:a})||(["form.data","form.view","o2m.form"].includes(n)?"invisible"in e&&("form.view"===n||(!["form.data","o2m.form"].includes(n)||Ut(e.invisible,{editable:o,record:i,context:s}))):["o2m.tree"].includes(n)||["tree"].includes(n)?"column_invisible"in e&&Ut(e.column_invisible,{editable:o,record:i,context:s}):!["search"].includes(n)||"invisible"in e&&Ut(e.invisible,{editable:o,record:i,context:s}))}const Tt={get_nodeinfo(e,t,n={}){const{is_one_row_children:a}=n,o=e[t];return a&&"string"!=typeof o&&(o.one_row=1),o},parse_node(e,t={}){const{last_nodename:n="sheet"}=t,{for_view:a}=t;return Object.keys(e).reduce(((o,i)=>{const[s,r]=function(e){const t=e.split("_"),[n,...a]=t;return[n,a.join("_").split("__")[0]]}(i),c=this.get_nodeinfo(e,i,t),d={fname:r,tagname:s,nodename:i,nodeinfo:c};if("unknow"===s);else if("string"==typeof e[i])o[i]=this.parse_node_string(e,i,t);else if("search"===a&&"field"===s){Rt(c,t)||(o[i]=this.parse_node_search_field(d,t))}else if("search"===a&&"groupby"===s)o[i]=this.parse_node_search_groupby(d,t);else if("search"===a&&"filter"===s)o[i]=this.parse_node_search_filter(d,t);else if("field"===s){Rt(c,t)||(o[i]=this.parse_node_field(d,t))}else if("label"===s){Rt(c,t)||(o[i]=this.parse_node_label(d,t))}else if("button"===s){Rt(c,t)||(o[i]=this.parse_node_button(d,t))}else{if(!["card","group","subgroup","notebook","page","widget","button"].includes(s))throw`error parse_node: ${n}.${i}`;{const{attr:e={},...n}=c;Rt(e,t)||(o[i]=this.parse_node_else(d,t))}}return o}),{})},parse_node_string(e,t={}){const{fname:n,tagname:a,nodename:o,nodeinfo:i}=e,{is_one_row_children:s}=t,r={text:i};return"widget"===a&&(r.name=n,r.one_row=s),s&&(r.one_row=s),{...r,tagname:a,nodename:o}},parse_node_search_field(e,t={}){const{fname:n,tagname:a,nodename:o,nodeinfo:i}=e,{fields:s,metadata:r}=t,c=r[n],d={...i};return delete d.groups,{meta:c,name:n,string:c.string,...d,tagname:a,nodename:o}},parse_node_search_groupby(e,t={}){const{fname:n,tagname:a,nodename:o,nodeinfo:i}=e;return{...i,tagname:a,nodename:o}},parse_node_search_filter(e,t={}){const{fname:n,tagname:a,nodename:o,nodeinfo:i}=e,{string:s,...r}=i;return{string:s,children:{...Object.keys(r).reduce(((e,t)=>(e[t]={...r[t],name:t},e)),{})},tagname:a,nodename:o}},parse_node_field(e,t={}){const{fname:n,tagname:a,nodename:o,nodeinfo:i}=e,{fields:s,metadata:r}=t,c=s[n]||{},d=r[n],_={...i};delete _.invisible,delete _.groups,delete _.readonly,delete _.required;const{env:l,editable:m,record:u,context:p,record_onchange:h}=t,y=function(e,{meta:t,editable:n,record:a,context:o}){if(!n)return!0;const i="readonly";return i in e?Ut(e[i],{record:a,context:o}):i in t?Ut(t[i],{record:a,context:o}):void 0}(i,{meta:d,editable:m,record:u,context:p}),f=function(e,{meta:t,editable:n,record:a,context:o}){if(!n)return!1;const i="required";return i in e?Ut(e[i],{record:a,context:o}):i in t?Ut(t[i],{record:a,context:o}):void 0}(i,{meta:d,editable:m,record:u,context:p}),g=function(e,{...t}){const{meta:n}=t,a="domain";if(!(a in n))return;return function(){const o=a in e?e[a]:n[a];return Ct.domain_maker(o,{...t})}()}(i,{meta:{...d,...s[d.name]||{}},editable:m,record:u||{},context:p}),b="context"in i?function(e,t={}){return Object.keys(e).reduce(((n,a)=>{const o=e[a];if(["string","number","boolean"].includes(typeof o))n[a]=o;else if(Array.isArray(o))n[a]=o;else{if("object"!=typeof o)throw console.log("context_get. doing",e,a,o),"error, context_get"+JSON.stringify(e);n[a]=Lt.eval_object(o,t)}return n}),{})}(i.context,{env:l,record:h||{},context:p}):void 0;return{meta:d,name:d.name,string:d.string,...c,..._,readonly:y,required:f,...g?{domain:g}:{},...b?{context:b}:{},tagname:a,nodename:o}},parse_node_label(e,t={}){const{fname:n,tagname:a,nodename:o,nodeinfo:i}=e,{last_nodename:s="sheet"}=t,r={...i};delete r.invisible,delete r.groups;const c=`${s}.${o}`,d=Tt.parse_node(r,{...t,last_nodename:c});return{...r,children:d,tagname:a,nodename:o}},parse_node_button(e,t={}){const{fname:n,tagname:a,nodename:o,nodeinfo:i}=e,{fields:s,metadata:r,module:c}=t,{last_nodename:d="sheet"}=t,{..._}=i;delete _.invisible,delete _.groups,"action"===_.type&&1===_.name.split(".").length&&(_.name=`${c}.${_.name}`);const[l,m]=Object.keys(_).reduce(((e,t)=>(["widget","field"].includes(t.split("_")[0])?e[0][t]=_[t]:e[1][t]=_[t],e)),[{},{}]),u=`${d}.${o}`;return{...m,children:Tt.parse_node(l,{...t,last_nodename:u}),tagname:a,nodename:o}},parse_node_else(e,t={}){const{fname:n,tagname:a,nodename:o,nodeinfo:i}=e,{last_nodename:s="sheet",is_group_children:r}=t,{is_one_row_children:c}=t,d=`${s}.${o}`,{attr:_={},...l}=i,m=Tt.parse_node(l,{...t,last_nodename:d,is_group_children:r||"group"===a,is_one_row_children:"one_row"===n||c}),u={..._};return delete u.invisible,delete u.groups,"widget"===a&&(u.name=n),{...u,children:m,tagname:"group"===a&&r?"subgroup":a,nodename:o}}};function It(e,t={}){return Tt.parse_node(e,t)}const zt={merge_fields(e={},t={}){return Object.keys({...e,...t}).reduce(((n,a)=>{const o=e[a]||{},i=t[a]||{},s={...o,...i};return"fields"in o&&"fields"in i&&(s.fields=this.merge_fields(o.fields,i.fields)),n[a]=s,n}),{})},fields_get_in_sheet(e){const t=this;const n=function e(n){return n?"object"!=typeof n?{}:Object.keys(n).reduce(((a,o)=>{const[i,s]=function(e){const t=e.split("_"),[n,...a]=t;return[n,a.join("_").split("__")[0]]}(o);if("field"===i){const e={[s]:{...{...n[o]}}};a=t.merge_fields(a,e)}else if("filter"===i);else{const t=e(n[o]);a={...a,...t}}return a}),{}):{}}(e);return n},fields_get_in_views(e){const t=Object.keys(e).reduce(((t,n)=>{const a=e[n],{arch:o={}}=a,{button_box:i={},header:s={},sheet:r={},kanban:c={}}=o;return t[`${n}.box`]=this.fields_get_in_sheet(i),t[`${n}.header`]=this.fields_get_in_sheet(s),t[`${n}.sheet`]=this.fields_get_in_sheet(r),t[`${n}.kanban`]=this.fields_get_in_sheet(c),t}),{});return Object.keys(t).reduce(((e,n)=>{const a=t[n];return Object.keys(a).forEach((t=>{const o=a[t]||{},i=e[t]||{};if(e[t]={...i},o.fields){const n={...o.fields};"display_name"in n||(n.display_name={});const a={[t]:{fields:n}};e=this.merge_fields(e,a)}if(o.views){const a=Object.keys(o.views).reduce(((e,t)=>(e[`${n}.${t}`]=o.views[t],e)),{}),i=this.fields_get_in_views(a);if(Object.keys(i).length){const n={[t]:{fields:{...i}}};e=this.merge_fields(e,n)}}})),e}),{})}};class Pt{constructor(e={}){const{config:t,action:n}=e;this._action=n,this._config=t}get config(){return this._config}check_has_sheet(){const{arch:e={}}=this.config,{sheet:t={}}=e;return!!Object.keys(t).length}get fields(){const e=this.config.fields||{},t=zt.fields_get_in_views({view_type_name:this.config}),n=zt.merge_fields(e,t);return Object.keys(n).length?n:this.action.config.fields||{}}get action(){return this._action}get module(){return this.action.module}get env(){return this.action.env}get model(){return this.action.model}get Model(){return this.action.Model}get metadata(){return this.action.metadata}get context(){return this.action.context}check_metadata(){return this.action.check_metadata()}get_arch_for_node(e,t){const n=(()=>{const e=this.action.fields_in_config,t=this.action.models_in_config,n=this.model;const a=(t[(o=n,["model",...o.split(".")].join("_"))]||{}).fields||{};var o;return Object.keys(e).reduce(((t,n)=>(t[n]={...a[n]||{},...e[n]||{}},t)),{})})(),a=this.metadata,o=this.context;return It(e,{...t,...{user_groups:this.action.rpc._groups.map((e=>e.name)),fields:n,metadata:a,context:o,env:this.env}})}_get_buttons(e){const{buttons:t={}}=e,n={...t};return{...this.action.buttons,...n}}get buttons(){return this._get_buttons(this.config)}async unlink(e){return this.Model.unlink(e)}async _call_button_action({name:e,record:t,records:n}){return{result:{action_name:e,context:{...{active_id:t?t.id:null,active_ids:n?n.map((e=>e.id)):[t.id],active_model:this.model}},target:"new",type:"ir.actions.act_window"}}}async _model_call_button(e,t,n={}){const a={...n,context:this.context},o=await this.Model.call_button(e,t,{...a}),{result:i,error:s}=o;if(s)return 200===s.code&&"odoo.exceptions.UserError"===s.data.name?{error:{name:"UserError",message:s.data.message}}:(console.log("call_button.error",e,s),Promise.reject(s));if(i){const e={active_id:t[0],active_ids:t,active_model:this.model},{context:n={}}=i;return{result:{...i,context:{...n,...e}}}}return{result:i}}async _call_button_object({name:e,action_map:t,record:n,records:a}){const o=a?a.map((e=>e.id)):[n.id],i={action_map:t,record:n,records:a},s=await this._model_call_button(e,o,{...i}),{result:r}=s;if(!r)return s;const{res_model:c}=r;if(!c)return s;const d=t[c];if(!d)return s;return{result:{...{action_name:d,...r},view_type:function(){const{view_mode:e}=r;if(!e)return;const t=e.split(",");return t.includes("list")||t.includes("kanban")?"tree":t.includes("form")?"form":void 0}()}}}async call_button({type:e,...t}){if("action"===e)return this._call_button_action({...t});if("object"===e)return this._call_button_object({...t});{const{name:n}=t;throw console.log("error, btn clicked",e,n),"call_button, not type"}}}class Qt extends Pt{constructor(e={}){super(e),this.length=0,this.limit=this.action.limit||10,this.current_page=1,this.order=this.action.order,this.search_view=this.action.search}get title(){return this.config.title||this.action.title}get_search_sheet(){return this.search_view.get_sheet()}_get_arch_sheet(){const{arch:e}=this.config;if(!e)throw console.log(this.config),"arch todo";const{sheet:t}=e,n={for_view:"tree"};return this.get_arch_for_node(t,n)}_get_sheet(){if(this.check_has_sheet())return this._get_arch_sheet();{const e=this.Model.get_fields_all(this.fields);return Object.keys(e).reduce(((t,n)=>(t[n]={...e[n],tagname:"odoofield",string:e[n].meta.string},t)),{})}}get_sheet(){return{children:this._get_sheet(),nodename:"sheet",tagname:"sheet"}}_get_arch_kanban(){const{arch:e}=this.config;if(!e)throw console.log(this.config),"arch todo";const{kanban:t={}}=e;if(!("kanban"in e))throw console.log("tree kanban todo",e),"kanban todo";const n={for_view:"tree"};return this.get_arch_for_node(t,n)}_get_kanban(){return this._get_arch_kanban()}get_kanban(){const e=this._get_kanban(),{card_title:t={},card_label:n={},card_value:a={}}=e;return{children:{card_title:t,card_label:n,card_value:a},nodename:"kanban",tagname:"kanban"}}get_toolbar_action(){const{toolbar:e={}}=this.config,{action:t={}}=e,n={for_view:"tree"};return this.get_arch_for_node(t,n)}get domain_in_action(){return this.action.domain}get domain(){const e=this.domain_in_action,t=this.search_view.domain;return e.length&&t.length?["&",...e,...t]:[...e,...t]}get offset(){return(this.current_page-1)*this.limit}async load_data(e={}){await this.check_metadata();const{current:t=1,pageSize:n,order:a}=e,{context:o={}}=e,{fields_for_all_views:i}=o,s=t<1?1:t;this.current_page=s,n&&(this.limit=n),a&&(this.order=a);const r=this.domain,c=this.context,d=i?this.action.fields:this.fields,_=this.limit,l={domain:r,fields:d,offset:this.offset,limit:_,order:this.order,context:c},m=await this.Model.load_web_data(l),{length:u,records:p}=m;return this.length=u,{current:s,pageSize:this.limit,total:u,records:p}}search_change(e){this.search_view.onchange(e)}get_search_default(){return this.search_view.get_default()}}class Bt extends Pt{constructor(e={}){super(e)}get_title({record:e}){if(this.config.title){const t=this.config.title;if("string"==typeof t)return t;if("object"==typeof t){const[n,...a]=Object.keys(t)[0].split("_");if("field"!==n)throw"error";const o=a.join("_"),i=e[o];if(!i)return this.action.title;return"many2one"===(this.metadata[o]||{}).type?i.display_name:i}throw"error for title"}return this.action.title}get_fields_all(e={}){const t=this.fields,{editmodel:n}=e;return n?n.get_fields_all(t):this.Model.get_fields_all(t)}_get_kws_for_arch_node(e={}){const t=this;const n=function(){const{record:n,values:a,editable:o}=e;if(!n)return{record:void 0,record_onchange:void 0,editable:o};const i=t.new_editmodel();return{editable:o,record:i._merge_to_modifiers(n,a),record_onchange:i._merge_to_onchange(n,a)}}();return{for_view:n.record?"form.data":"form.view",module:this.module,...n}}_get_arch_sheet(e={}){const{arch:t}=this.config,{sheet:n}=t,a=this._get_kws_for_arch_node(e);return this.get_arch_for_node(n,a)}_get_sheet(e={}){if(this.check_has_sheet())return this._get_arch_sheet(e);{const t=this.get_fields_all(e);return Object.keys(t).reduce(((e,n)=>(e[n]={...t[n],tagname:"odoofield",string:t[n].meta.string},e)),{})}}get_sheet(e={}){return{children:this._get_sheet(e),nodename:"sheet",tagname:"sheet"}}_get_footer(e={}){const{arch:t}=this.config,{footer:n={}}=t,a=this._get_kws_for_arch_node(e);return this.get_arch_for_node(n,a)}get_footer(e={}){return this._get_footer(e)}get_box(e={}){const{arch:t}=this.config,{button_box:n={}}=t,a=this._get_kws_for_arch_node(e);return this.get_arch_for_node(n,a)}_get_header(e={}){const{arch:t}=this.config;if(!t)throw console.log("error arch ",this),"error arch ";const{header:n={}}=t,a=this._get_kws_for_arch_node(e);return this.get_arch_for_node(n,a)}get_toolbar(e={}){const t=this._get_header(e);return Object.keys(t).reduce(((e,n)=>{const a=t[n];return"button"===a.tagname&&(e[n]=a),e}),{})}get_statusbar(e={}){const t=this._get_header(e),n=Object.keys(t).reduce(((e,n)=>{const a=t[n];return"field"===a.tagname&&"statusbar"===a.widget&&(e=a),e}),void 0);if(!n)return;if(!n.statusbar_visible)return;const a=n.statusbar_visible.split(","),{record:o}=e;a.includes(o.state)||a.push(o.state);const i=(()=>{if("selection"in n){const{selection:e=[]}=n;return e}{const{selection:e=[]}=this.metadata.state;return e}})().reduce(((e,t)=>(e[t[0]]=t[1],e)),{});return a.reduce(((e,t,n)=>{const a={value:t,label:i[t],index:n,active:t===o.state};return t===o.state&&(e[0]=a),e[1][t]=a,e}),[{},{}])}async load_data(e,t={}){const n=this.context,a={fields:this.fields,context:n};return await this.Model.load_data_one(e,a)}new_editmodel(){return this.env.editmodel(this.model,{metadata:this.metadata,context:this.context})}get_title_new(){return this.config.title_new||"新增"}get rules(){return this.config.rules||{}}}function Gt(e,t){const[n,a]=e.reduce(((e,n)=>{if(n&&n.length){const[a,o]=e;o&&(e[0]=a?[...a,t,...o]:o),e[1]=n}return e}),[null,null]);return n&&a?[t,...n,...a]:n||a||[]}function Ht(e){return"field"===e.tagname?function(e){const t=e.value,n=e.filter_domain||[[e.name,"ilike",{self:{}}]];return Gt(t.map((e=>Ct.domain_maker(n,{self:e}))),"|")}(e):"filter"===e.tagname?function(e){return Gt(Object.keys(e.value).filter((t=>e.value[t].checked)).map((t=>{const n=e.value[t].domain;return Ct.domain_maker(n,{})})),"|")}(e):(console.log("errror "),[])}class Kt extends Pt{constructor(e={}){super(e),this.values={}}get domain(){var e;return e=this.values,Gt(Object.keys(e).map((t=>Ht(e[t]))),"&")}_get_sheet(){const{arch:e={}}=this.config,{sheet:t={}}=e,n={for_view:"search"};return this.get_arch_for_node(t,n)}get_sheet(){const e=this._get_sheet();return Object.keys(e).length?{children:e,nodename:"sheet",tagname:"sheet"}:{children:{field_name:{string:this.metadata.name.string,name:"name",meta:this.metadata.name,nodename:"field_name",tagname:"field"}},nodename:"sheet",tagname:"sheet"}}onchange(e){this.values=e}get_default(){const e=this.get_sheet().children,t=this.context,n=Object.keys(t).filter((e=>"search_default_"===e.slice(0,15))).reduce(((e,n)=>(e[n.slice(15)]=t[n],e)),{});return Object.keys(e).reduce(((t,a)=>{const{meta:o,default:i,children:s,...r}=e[a];if("field"===r.tagname)t[a]={...r,value:[]};else if("filter"===r.tagname){const e=Object.keys(s).reduce(((e,t)=>(e[t]={...s[t],checked:t in n},e)),{});t[a]={...r,value:e}}return t}),{})}}class Vt{constructor(e,t={}){const{rpc:n,models:a={},metadata:o}=t;this._models_in_config=a,this._rpc=n,this._config=e,this._metadata_ready=!!o,this._metadata=o||{}}get rpc(){return this._rpc}get env(){return this.rpc.env}get config(){return this._config}get views(){return this.config.views||{}}get module(){return this.config.module}get models_in_config(){return this._models_in_config}get fields_in_config(){const e=this.config.fields||{},t={...this.views},n=this.config.search_view_id||{};n.arch&&(t.search={...n});const a=zt.fields_get_in_views(t);return zt.merge_fields(e,a)}get fields(){const e=function e(t){return Object.keys(t).reduce(((n,a)=>{const o={},i=t[a]||{};return i.fields&&(o.fields=e(i.fields)),n[a]=o,n}),{})}(this.fields_in_config);return e}get metadata(){return this._metadata}get res_model(){return this.config.res_model}get model(){return this.config.res_model}get Model(){return this.env.model(this.model,{metadata:this.metadata})}get title(){return this.config.name}get context(){const e=this.rpc.lang,t=this.env.context||{},n=this.config.context||{};if("function"==typeof n){const a=n({env:this.env});return{...t,...a,lang:e}}return{...t,...n,lang:e}}get domain(){return this.config.domain||[]}get order(){return this.config.order||void 0}get limit(){return this.config.limit||10}_get_buttons(e){const{buttons:t={}}=e,n={...t};return"create"in n||(n.create=!0),"edit"in n||(n.edit=!0),"delete"in n||(n.delete=!0),n}get buttons(){return this._get_buttons(this.config)}async check_metadata(){if(!this._metadata_ready)return load_metadata()}async load_metadata(e={}){const{callback:t}=e,n=this.env.model(this.model),a=this.fields,o=this.context,i=await n.load_metadata({fields:a,context:o,callback:e=>{this._metadata=e,t&&t(this._metadata)}});return this._metadata=i,this._metadata_ready=!0,i}async load_res_id(){const{res_id:e}=this.config;if(e){if("object"!=typeof e)return e;return(await this.env.ref(e.ref)).id}return e}}class Wt extends Vt{constructor(e,t={}){super(e,t)}_get_view2(e,t){const{creater:n,...a}=e;if(n&&"function"==typeof n){return new(n(t))({action:this,config:a})}return new t({action:this,config:a})}_get_view(e,t){const n=this.views[e]||{};return this._get_view2(n,t)}get search(){const e=this.config.search_view_id||{};return this._get_view2(e,Kt)}get tree(){return this._get_view("tree",Qt)}get form(){return this._get_view("form",Bt)}}class Xt{constructor(e={}){const{config:t,relation_node:n}=e;this._relation_node=n,this._config=t}get config(){return this._config}get relation_node(){return this._relation_node}get node(){return this.relation_node.node}check_has_sheet(){const{arch:e={}}=this.config,{sheet:t={}}=e;return!!Object.keys(t).length}get fields(){const e=this.config.fields||{},t=zt.fields_get_in_views({view_type_name:this.config}),n=zt.merge_fields(e,t);return Object.keys(n).length?n:this.node.fields||{}}get env(){return this.relation_node.env}get model(){return this.relation_node.model}get Model(){return this.relation_node.Model}get metadata(){return this.relation_node.metadata}get context(){return this.relation_node.context}get_parent_editmodel(e){const{model:t,metadata:n}=e;return this.env.editmodel(t,{metadata:n})}get_parent_data(e={}){const{record:t={},values:n={}}=e;return this.get_parent_editmodel(e)._merge_to_modifiers(t,n)}get_arch_for_node(e,t={}){return It(e,{...{fields:(()=>{const e=this.relation_node.fields_in_config,t=this.relation_node.models_in_config,n=this.model;const a=(t[(o=n,["model",...o.split(".")].join("_"))]||{}).fields||{};var o;return Object.keys(e).reduce(((t,n)=>(t[n]={...a[n]||{},...e[n]||{}},t)),{})})(),metadata:this.metadata,context:this.context,user_groups:this.relation_node.rpc._groups.map((e=>e.name)),env:this.env},...t})}}class Yt extends Xt{constructor(e={}){super(e)}async search_read(e){const t=Object.keys(this.metadata);return this.Model.search_read({domain:e,fields:t})}_get_arch_sheet(e={}){const{arch:t}=this.config,{sheet:n}=t,{parent_info:a}=e,o={for_view:"o2m.tree",record:{parent:this.get_parent_data(a)}};return this.get_arch_for_node(n,o)}_get_sheet(e={}){if(this.check_has_sheet())return this._get_arch_sheet(e);{const e=this.Model.get_fields_all(this.fields);return Object.keys(e).reduce(((t,n)=>(t[n]={...e[n],tagname:"odoofield",string:e[n].meta.string},t)),{})}}get_sheet(e={}){return{children:this._get_sheet(e),nodename:"sheet",tagname:"sheet"}}_get_arch_kanban(e={}){const{arch:t}=this.config;if(!t)throw console.log("_get_arch_kanban, no arch",this),"arch todo";const{kanban:n}=t;if(!("kanban"in t))throw console.log("o2m tree kanban todo",t),"kanban todo";const{parent_info:a}=e,o={for_view:"o2m.tree",record:{parent:this.get_parent_data(a)}};return this.get_arch_for_node(n,o)}_get_kanban(e={}){return this._get_arch_kanban(e)}get_kanban(e={}){const t=this._get_kanban(e),{card_title:n={},card_label:a={},card_value:o={}}=t;return{children:{card_title:n,card_label:a,card_value:o},nodename:"kanban",tagname:"kanban"}}}class Zt extends Xt{constructor(e={}){super(e)}get rules(){return this.node.rules}new_editmodel(){return this.relation_node.relation.Editmodel}get_fields_all(e={}){const t=this.fields,{editmodel:n}=e;return n?n.get_fields_all(t):this.Model.get_fields_all(t)}_get_arch_sheet(e={}){const{arch:t}=this.config,{sheet:n}=t,a=this;const o=function(){const{parent_info:t}=e,{record:n,values:o,editable:i}=e,s=a.env.editx2m(a.model,{field_info:a.node.meta}),r=s._merge_to_modifiers(n,o),c=s._merge_to_onchange(n,o),d=a.get_parent_data(t),_={...r,parent:d},l={...c,parent:d};return{editable:i&&!a.node.readonly,record:_,record_onchange:l}}(),i={for_view:"o2m.form",...o};return this.get_arch_for_node(n,i)}_get_sheet(e={}){if(this.check_has_sheet())return this._get_arch_sheet(e);{const t=this.get_fields_all(e);return Object.keys(t).reduce(((e,n)=>(e[n]={...t[n],tagname:"odoofield",string:t[n].meta.string},e)),{})}}get_sheet(e={}){return{children:this._get_sheet(e),nodename:"sheet",tagname:"sheet"}}}class en{constructor(e,t={}){const{rpc:n,models:a}=t;this._models_in_config=a,this._node=e,this._rpc=n;const{meta:o}=this.node;this.relation=this.env.one2many(o,{context:this.context})}get node(){return this._node}get rpc(){return this._rpc}get env(){return this.rpc.env}get views(){return this.node.views||{}}get models_in_config(){return this._models_in_config}get fields_in_config(){const e=this.node.fields||{},t=zt.fields_get_in_views(this.views);return zt.merge_fields(e,t)}get context(){const{context:e={}}=this.node;return e}get metadata(){const{meta:e}=this.node;return e.metadata}get model(){const{meta:e}=this.node;return e.relation}get Model(){return this.env.model(this.model,{metadata:this.node.meta.metadata})}_get_view(e,t){return new t({relation_node:this,config:this.views[e]||{}})}get tree(){return this._get_view("tree",Yt)}get form(){return this._get_view("form",Zt)}async load_select_options(e={}){const{meta:t,domain:n=[],fields:a={}}=this.node,o=this.env.relation({...t,domain:n}),{current:i=1,pageSize:s=8,fields:r={}}=e,c=i<1?1:i,d=(c-1)*s,_={...a,...r},l=await o.load_select_options({...e,offset:d,limit:s,fields:_}),{length:m,records:u}=l;return{current:c,pageSize:s,total:m,records:u}}remove_one(e,{records:t,values:n}){const a=this.relation;a.set_edit({records:t,values:n}),a.remove_one(e.id);return a.records_edit}}class tn extends xt{constructor(e){super(e),this._groups=[],this._lang=null}get lang(){return this._lang||"en_US"}set lang(e){this._lang=e}async after_session(){this._lang||(this._lang=this.web.session.lang),super.after_session()}_action_load(e,{actions:t}){const[n,a]=e.split("."),o=t[n][a];if(!o)throw console.log(`${e} no defined`),`${e} no defined`;return o}action(e,t={}){const{models:n={},actions:a,metadata:o,...i}=t,s=this._action_load(e,{actions:a}),r=this;const c=function(){const{context:e={}}=s,t=function(e,t={}){const n=Object.keys(e).reduce(((n,a)=>{const o=e[a];if(["string","number","boolean"].includes(typeof o))n[a]=o;else if(Array.isArray(o))n[a]=o;else{if("object"!=typeof o)throw console.log("context_get. doing",e,a,o),"error, context_get"+JSON.stringify(e);n[a]=Lt.eval_object(o,t)}return n}),{});return n}(e,{env:r.env}),{context:n={}}=i;return{...t,...n}}(),d={...s,...i,context:c};return new Wt(d,{rpc:this,models:n,metadata:o})}relation_node(e,t={}){const{models:n={}}=t;return new en(e,{rpc:this,models:n})}}const nn={rpc:null};function an(e){if(nn.rpc)return nn.rpc;{const t=new tn(e);return nn.rpc=t,t}}export{tn as OdooJSRPC,an as get_odoojs_rpc};
